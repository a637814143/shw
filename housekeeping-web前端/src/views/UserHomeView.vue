<template>
  <div class="user-home-container">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="top-header">
      <div class="header-content">
        <div class="logo-section">
          <h1 class="logo">å®¶æ”¿æœåŠ¡å¹³å°</h1>
        </div>
        <div class="user-section">
          <div class="user-info" @click="toggleUserDropdown">
            <div class="user-avatar">
              <img v-if="userAvatar" :src="userAvatar" alt="å¤´åƒ" class="avatar-image">
              <div v-else class="avatar-placeholder">ğŸ»</div>
            </div>
            <span class="username">{{ userInfo.username }}</span>
            <div class="dropdown-arrow" :class="{ active: showUserDropdown }">â–¼</div>
          </div>
          
          <!-- ç”¨æˆ·ä¸‹æ‹‰èœå• -->
          <div v-if="showUserDropdown" class="user-dropdown" @click.stop>
            <div class="dropdown-item" @click="handleMyFavorites">
              <span>æˆ‘çš„æ”¶è—</span>
            </div>
            <div class="dropdown-item" @click="handleRechargeRecords">
              <span>å……å€¼è®°å½•</span>
            </div>
            <div class="dropdown-item" @click="handlePersonalInfo">
              <span>ä¸ªäººä¿¡æ¯</span>
            </div>
            <div class="dropdown-item" @click="handleChangePassword">
              <span>ä¿®æ”¹å¯†ç </span>
            </div>
            <div class="dropdown-item" @click="logout">
              <span>é€€å‡ºç™»å½•</span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸå®¹å™¨ -->
    <div class="content-wrapper">
      <!-- ä¾§è¾¹å¯¼èˆªèœå• -->
      <nav class="sidebar-nav">
        <ul class="nav-menu">
          <li class="nav-item" :class="{ active: activeMenu === 'home' }" @click="setActiveMenu('home')">
            <div class="nav-icon">ğŸ </div>
            <span class="nav-text">é¦–é¡µ</span>
          </li>
          <li class="nav-item" :class="{ active: activeMenu === 'services' }" @click="setActiveMenu('services')">
            <div class="nav-icon">ğŸ§¹</div>
            <span class="nav-text">å®¶æ”¿æœåŠ¡</span>
          </li>
          <li class="nav-item" :class="{ active: activeMenu === 'tips' }" @click="setActiveMenu('tips')">
            <div class="nav-icon">ğŸ’¡</div>
            <span class="nav-text">å±…å®¶å°è´´å£«</span>
          </li>
          <li class="nav-item" :class="{ active: activeMenu === 'booking' }" @click="setActiveMenu('booking')">
            <div class="nav-icon">ğŸ“…</div>
            <span class="nav-text">å®¶æ”¿é¢„çº¦</span>
          </li>
          <li class="nav-item" :class="{ active: activeMenu === 'reviews' }" @click="setActiveMenu('reviews')">
            <div class="nav-icon">â­</div>
            <span class="nav-text">æœåŠ¡è¯„ä»·</span>
          </li>
        </ul>
      </nav>

      <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
      <!-- é¦–é¡µå†…å®¹ -->
      <div v-if="activeMenu === 'home'" class="content-section">
        <!-- è‹±é›„åŒºåŸŸ -->
        <div class="hero-section">
          <div class="hero-content">
            <div class="hero-text">
              <h1 class="hero-title">å®¶æ”¿æœåŠ¡</h1>
              <h2 class="hero-subtitle">ç‰¹æƒ </h2>
            </div>
            <div class="hero-illustration">
              <div class="room-scene">
                <div class="sofa">
                  <div class="woman">
                    <div class="woman-body"></div>
                    <div class="woman-head"></div>
                    <div class="book"></div>
                  </div>
                  <div class="child">
                    <div class="child-body"></div>
                    <div class="child-head"></div>
                  </div>
                  <div class="cat"></div>
                </div>
                <div class="plant"></div>
                <div class="clothes"></div>
                <div class="stool"></div>
                <div class="pictures">
                  <div class="picture-1"></div>
                  <div class="picture-2"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- æœåŠ¡åˆ†ç±»æ ‡ç­¾ -->
        <div class="service-category-tag">
          <span>å®¶æ”¿æœåŠ¡</span>
        </div>
        
        <!-- æœåŠ¡ç½‘æ ¼ -->
        <div class="home-services-grid">
          <div class="service-card" @click="setActiveMenu('services')">
            <div class="service-icon daily-cleaning">ğŸ§¹</div>
            <h3>æ—¥å¸¸ä¿æ´</h3>
            <p>ä¸“ä¸šå·¥å…·,æ“¦æ´—æ‰«æ‹–</p>
          </div>
          
          <div class="service-card" @click="setActiveMenu('services')">
            <div class="service-icon window-cleaning">ğŸªŸ</div>
            <h3>æ“¦ç»ç’ƒ</h3>
            <p>ä¸“ä¸šå–·å‰‚,æ´å‡€ç»ç’ƒ</p>
          </div>
          
          <div class="service-card" @click="setActiveMenu('services')">
            <div class="service-icon deep-cleaning">ğŸ§½</div>
            <h3>æ·±åº¦ä¿æ´</h3>
            <p>æ˜æ˜ŸæœåŠ¡,æ´å‡€è¶…ä¹æƒ³è±¡</p>
          </div>
          
          <div class="service-card" @click="setActiveMenu('services')">
            <div class="service-icon new-home">ğŸ </div>
            <h3>æ–°å±…å¼€è’</h3>
            <p>æ–°å±…å…¥ä½å‰...</p>
          </div>
          
          <div class="service-card" @click="setActiveMenu('services')">
            <div class="service-icon kitchen">ğŸ³</div>
            <h3>å¨æˆ¿ä¿å…»</h3>
            <p>å¨æˆ¿æ·±åº¦æ¸…æ´...</p>
          </div>
          
          <div class="service-card" @click="setActiveMenu('services')">
            <div class="service-icon bathroom">ğŸš¿</div>
            <h3>å«ç”Ÿé—´ä¿å…»</h3>
            <p>å«ç”Ÿé—´ä¸“ä¸šæ¸…æ´...</p>
          </div>
        </div>
      </div>

      <!-- å®¶æ”¿æœåŠ¡å†…å®¹ -->
      <div v-if="activeMenu === 'services'" class="content-section">
        <!-- æœåŠ¡åˆ†ç±»å¯¼èˆª -->
        <div class="service-categories">
          <div
            v-for="category in serviceCategories"
            :key="category.id"
            class="category-item"
            :class="{ active: activeCategory === category.id }"
            @click="selectCategory(category.id)"
          >
            {{ category.name }}
          </div>
        </div>

        <div v-if="categoryErrorMessage" class="service-status error-message">{{ categoryErrorMessage }}</div>
        <div v-else-if="isCategoryLoading" class="service-status loading-message">åˆ†ç±»åŠ è½½ä¸­...</div>

        <!-- æœç´¢æ  -->
        <div class="search-bar">
          <input
            type="text"
            placeholder="è¯·è¾“å…¥æœåŠ¡åç§°æœç´¢"
            class="search-input"
            v-model="serviceSearchKeyword"
            @keyup.enter.prevent="searchServices()"
            @input="handleServiceSearchInput"
          >
          <button class="search-btn" @click="searchServices()">æœç´¢</button>
          <button v-if="serviceSearchKeyword" class="clear-btn" @click="clearServiceSearch">æ¸…ç©º</button>
        </div>

        <div v-if="serviceErrorMessage" class="service-status error-message">{{ serviceErrorMessage }}</div>
        <div v-else-if="isServiceLoading" class="service-status loading-message">æœåŠ¡åŠ è½½ä¸­...</div>
        <div v-else>
          <div class="services-grid" v-if="filteredServices.length > 0">
            <div v-for="service in filteredServices" :key="service.id" class="service-card">
              <div class="card-decorations">
                <div class="red-triangle top-left"></div>
                <div class="red-triangle top-right"></div>
              </div>
              <div class="service-title-bar">
                <span class="service-title">{{ service.name }}</span>
              </div>
              <div class="service-subtitle">æé€Ÿä¸Šé—¨ å“è´¨æœåŠ¡</div>
              <div class="service-description">{{ service.description }}</div>
              <div class="service-footer">
                <div class="service-price">Â¥{{ service.price }}/{{ service.unit }}</div>
                <div class="service-booked">å·²çº¦{{ service.booked }}æ¬¡</div>
              </div>
            </div>
          </div>

          <div v-else class="no-results">
            <div class="no-results-icon">ğŸ”</div>
            <div class="no-results-text">æœªæ‰¾åˆ°ç›¸å…³æœåŠ¡</div>
            <div class="no-results-hint">è¯·å°è¯•å…¶ä»–å…³é”®è¯æˆ–æ¸…ç©ºæœç´¢æ¡ä»¶</div>
          </div>
        </div>

        <!-- åˆ†é¡µ -->
        <div class="pagination">
          <div class="pagination-info">å…±{{ servicePageInfo.total }}æ¡</div>
          <div class="pagination-controls">
            <button
              class="page-btn"
              :disabled="servicePageInfo.current <= 1"
              @click="changeServicePage(servicePageInfo.current - 1)"
            >â€¹</button>
            <button class="page-btn active">{{ servicePageInfo.current }}</button>
            <button
              class="page-btn"
              :disabled="servicePageInfo.pages === 0 || servicePageInfo.current >= servicePageInfo.pages"
              @click="changeServicePage(servicePageInfo.current + 1)"
            >â€º</button>
            <span class="page-summary">å…±{{ servicePageInfo.pages }}é¡µ</span>
          </div>
        </div>
      </div>

      <!-- å±…å®¶å°è´´å£«å†…å®¹ -->
      <div v-if="activeMenu === 'tips'" class="content-section">
        <h2>å±…å®¶å°è´´å£«</h2>
        
        <!-- æœç´¢æ¡† -->
        <div class="tips-search-bar">
          <input 
            type="text" 
            placeholder="è¯·è¾“å…¥æ ‡é¢˜å…³é”®å­—æœç´¢" 
            class="tips-search-input" 
            v-model="tipsSearchKeyword"
            @keyup.enter="searchTips"
            @input="searchTips"
          >
          <button class="tips-search-btn" @click="searchTips">æœç´¢</button>
          <button v-if="tipsSearchKeyword" class="clear-btn" @click="clearTipsSearch">æ¸…ç©º</button>
        </div>
        
        <div class="tips-list">
          <div v-for="tip in filteredTips" :key="tip.id" class="tip-item">
            <div class="tip-image">
              <img :src="tip.image" :alt="tip.title">
            </div>
            <div class="tip-content">
              <h3>{{ tip.title }}</h3>
              <p>{{ tip.content }}</p>
              <div class="tip-meta">
                <span class="tip-views">ğŸ‘ï¸ {{ tip.views }}</span>
                <span class="tip-date">ğŸ• {{ tip.date }}</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- æ— æœç´¢ç»“æœæç¤º -->
        <div v-if="filteredTips.length === 0" class="no-results">
          <div class="no-results-icon">ğŸ”</div>
          <div class="no-results-text">æœªæ‰¾åˆ°ç›¸å…³å°è´´å£«</div>
          <div class="no-results-hint">è¯·å°è¯•å…¶ä»–å…³é”®è¯æˆ–æ¸…ç©ºæœç´¢æ¡ä»¶</div>
        </div>
      </div>

      <!-- å®¶æ”¿é¢„çº¦å†…å®¹ -->
      <div v-if="activeMenu === 'booking'" class="content-section">
        <h2>å®¶æ”¿é¢„çº¦</h2>
        
        <!-- æœç´¢æ  -->
        <div class="booking-search-bar">
          <input 
            type="text" 
            placeholder="è¯·è¾“å…¥æœåŠ¡åç§°æŸ¥è¯¢" 
            class="booking-search-input" 
            v-model="bookingSearchKeyword"
            @keyup.enter="searchBookings"
            @input="searchBookings"
          >
          <button class="booking-search-btn" @click="searchBookings">æŸ¥è¯¢</button>
          <button v-if="bookingSearchKeyword" class="clear-btn" @click="clearBookingSearch">æ¸…ç©º</button>
        </div>
        
        <!-- é¢„çº¦æ•°æ®è¡¨æ ¼ -->
        <div class="booking-table-container">
          <table class="booking-table">
            <thead>
              <tr>
                <th>æœåŠ¡åç§°</th>
                <th>æ•°é‡</th>
                <th>æ€»é‡‘é¢</th>
                <th>æœåŠ¡è€…</th>
                <th>è”ç³»ç”µè¯</th>
                <th>è”ç³»åœ°å€</th>
                <th>æœåŠ¡è€…ç”µè¯</th>
                <th>çŠ¶æ€</th>
                <th>å¼€å§‹æ—¶é—´</th>
                <th>ç»“æŸæ—¶é—´</th>
                <th>é¢„çº¦æ—¶é—´</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="booking in filteredBookings" :key="booking.id">
                <td>{{ booking.serviceName }}</td>
                <td>{{ booking.quantity }}</td>
                <td class="amount">Â¥{{ booking.totalAmount }}</td>
                <td>{{ booking.serviceProvider || '-' }}</td>
                <td>{{ booking.contactPhone || '-' }}</td>
                <td>{{ booking.contactAddress || '-' }}</td>
                <td>{{ booking.serviceProviderPhone || '-' }}</td>
               <td>
                 <span class="status" :class="booking.status">
                   {{ 
                     booking.status === 'completed' ? 'å·²å®Œæˆ' : 
                     booking.status === 'pending' ? 'å¾…åˆ†é…' : 
                     booking.status === 'in-service' ? 'æœåŠ¡ä¸­' :
                     booking.status === 'evaluated' ? 'å·²è¯„ä»·' :
                     booking.status === 'cancelled' ? 'å·²å–æ¶ˆ' : 'æœªçŸ¥çŠ¶æ€'
                   }}
                 </span>
               </td>
                <td>{{ booking.startTime }}</td>
                <td>{{ booking.endTime }}</td>
                <td>{{ booking.appointmentTime || '-' }}</td>
               <td class="operation-cell">
                 <div class="operation-buttons">
                   <button v-if="booking.status === 'completed'" class="operation-btn evaluate" @click="evaluateBooking(booking)">è¯„ä»·</button>
                   <button v-if="booking.status === 'pending' || booking.status === 'in-service'" class="operation-btn cancel" @click="cancelBooking(booking.id)">å–æ¶ˆ</button>
                   <span v-if="booking.status === 'evaluated' || booking.status === 'cancelled'" class="no-action">-</span>
                 </div>
               </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <!-- åˆ†é¡µ -->
        <div class="booking-pagination">
          <div class="pagination-info">å…±{{ filteredBookings.length }}æ¡</div>
          <div class="pagination-controls">
            <button class="page-btn">â€¹</button>
            <button class="page-btn active">1</button>
            <button class="page-btn">2</button>
            <button class="page-btn">â€º</button>
          </div>
        </div>
      </div>

      <!-- æœåŠ¡è¯„ä»·å†…å®¹ -->
      <div v-if="activeMenu === 'reviews'" class="content-section">
        <h2>æœåŠ¡è¯„ä»·</h2>
        
        <!-- æœç´¢æ  -->
        <div class="reviews-search-bar">
          <input 
            type="text" 
            placeholder="è¯·è¾“å…¥æœåŠ¡åç§°æŸ¥è¯¢" 
            class="reviews-search-input" 
            v-model="reviewsSearchKeyword"
            @keyup.enter="searchReviews"
            @input="searchReviews"
          >
          <button class="reviews-search-btn" @click="searchReviews">æŸ¥è¯¢</button>
          <button v-if="reviewsSearchKeyword" class="clear-btn" @click="clearReviewsSearch">æ¸…ç©º</button>
        </div>
        
        <!-- æ‰¹é‡åˆ é™¤æŒ‰é’® -->
        <div class="batch-actions">
          <button class="batch-delete-btn" @click="batchDelete">æ‰¹é‡åˆ é™¤</button>
        </div>
        
        <!-- è¯„ä»·æ•°æ®è¡¨æ ¼ -->
        <div class="reviews-table-container">
          <table class="reviews-table">
            <thead>
              <tr>
                <th>
                  <input type="checkbox" class="select-all" @change="toggleSelectAll">
                </th>
                <th>æœåŠ¡è€…</th>
                <th>æœåŠ¡åç§°</th>
                <th>è¯„åˆ†</th>
                <th>å†…å®¹</th>
                <th>è¯„ä»·æ—¶é—´</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="review in filteredReviews" :key="review.id">
                <td><input type="checkbox" class="row-checkbox"></td>
                <td>{{ review.serviceProvider }}</td>
                <td>{{ review.serviceName }}</td>
                <td>
                  <div class="star-rating">
                    <span v-for="i in 5" :key="i" class="star" 
                          :class="{
                            'filled': i <= Math.floor(review.rating),
                            'half': i === Math.ceil(review.rating) && review.rating % 1 !== 0,
                            'empty': i > Math.ceil(review.rating)
                          }">â˜…</span>
                  </div>
                </td>
                <td>{{ review.content }}</td>
                <td>{{ review.reviewTime }}</td>
                <td>
                  <button class="action-btn edit" @click="editReview(review)">âœï¸</button>
                  <button class="action-btn delete" @click="deleteReview(review.id)">ğŸ—‘ï¸</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <!-- åˆ†é¡µ -->
        <div class="reviews-pagination">
          <div class="pagination-info">å…±{{ filteredReviews.length }}æ¡</div>
          <div class="pagination-controls">
            <button class="page-btn">â€¹</button>
            <button class="page-btn active">1</button>
            <button class="page-btn">â€º</button>
          </div>
        </div>
      </div>
    </main>
    </div>

    <!-- ç¼–è¾‘è¯„ä»·æ¨¡æ€æ¡† -->
    <div v-if="showReviewModal" class="modal-overlay" @click="cancelReviewEdit">
      <div class="modal-content" @click.stop>
        <div class="modal-header">
          <h3>ç¼–è¾‘è¯„ä»·</h3>
          <button class="close-btn" @click="cancelReviewEdit">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>æœåŠ¡æä¾›è€…ï¼š</label>
            <input type="text" v-model="reviewForm.serviceProvider" class="form-input">
          </div>
          <div class="form-group">
            <label>æœåŠ¡åç§°ï¼š</label>
            <input type="text" v-model="reviewForm.serviceName" class="form-input">
          </div>
          <div class="form-group">
            <label>è¯„åˆ†ï¼š</label>
            <div class="rating-input">
              <select v-model="reviewForm.rating" class="form-select">
                <option value="1">1æ˜Ÿ</option>
                <option value="1.5">1.5æ˜Ÿ</option>
                <option value="2">2æ˜Ÿ</option>
                <option value="2.5">2.5æ˜Ÿ</option>
                <option value="3">3æ˜Ÿ</option>
                <option value="3.5">3.5æ˜Ÿ</option>
                <option value="4">4æ˜Ÿ</option>
                <option value="4.5">4.5æ˜Ÿ</option>
                <option value="5">5æ˜Ÿ</option>
              </select>
              <div class="star-preview">
                <span v-for="i in 5" :key="i" class="star" 
                      :class="{
                        'filled': i <= Math.floor(reviewForm.rating),
                        'half': i === Math.ceil(reviewForm.rating) && reviewForm.rating % 1 !== 0,
                        'empty': i > Math.ceil(reviewForm.rating)
                      }">â˜…</span>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label>è¯„ä»·å†…å®¹ï¼š</label>
            <textarea v-model="reviewForm.content" class="form-textarea" rows="3"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" @click="cancelReviewEdit">å–æ¶ˆ</button>
          <button class="btn btn-primary" @click="saveReviewEdit">ä¿å­˜</button>
        </div>
      </div>
    </div>

    <!-- é¢„çº¦è¯„ä»·æ¨¡æ€æ¡† -->
    <div v-if="showBookingEvaluateModal" class="modal-overlay" @click="cancelBookingEvaluate">
      <div class="modal-content" @click.stop>
        <div class="modal-header">
          <h3>æœåŠ¡è¯„ä»·</h3>
          <button class="close-btn" @click="cancelBookingEvaluate">Ã—</button>
        </div>
        <div class="modal-body">
          <div v-if="evaluatingBooking" class="booking-info">
            <h4>æœåŠ¡ä¿¡æ¯</h4>
            <p><strong>æœåŠ¡åç§°ï¼š</strong>{{ evaluatingBooking.serviceName }}</p>
            <p><strong>æœåŠ¡æä¾›è€…ï¼š</strong>{{ evaluatingBooking.serviceProvider || 'æœªçŸ¥' }}</p>
            <p><strong>æœåŠ¡æ—¶é—´ï¼š</strong>{{ evaluatingBooking.startTime }} - {{ evaluatingBooking.endTime }}</p>
          </div>
          <div class="form-group">
            <label>è¯„åˆ†ï¼š</label>
            <div class="rating-input">
              <select v-model="bookingEvaluateForm.rating" class="form-select">
                <option value="1">1æ˜Ÿ</option>
                <option value="1.5">1.5æ˜Ÿ</option>
                <option value="2">2æ˜Ÿ</option>
                <option value="2.5">2.5æ˜Ÿ</option>
                <option value="3">3æ˜Ÿ</option>
                <option value="3.5">3.5æ˜Ÿ</option>
                <option value="4">4æ˜Ÿ</option>
                <option value="4.5">4.5æ˜Ÿ</option>
                <option value="5">5æ˜Ÿ</option>
              </select>
              <div class="star-preview">
                <span v-for="i in 5" :key="i" class="star" 
                      :class="{
                        'filled': i <= Math.floor(bookingEvaluateForm.rating),
                        'half': i === Math.ceil(bookingEvaluateForm.rating) && bookingEvaluateForm.rating % 1 !== 0,
                        'empty': i > Math.ceil(bookingEvaluateForm.rating)
                      }">â˜…</span>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label>è¯„ä»·å†…å®¹ï¼š</label>
            <textarea v-model="bookingEvaluateForm.content" class="form-textarea" rows="4" placeholder="è¯·åˆ†äº«æ‚¨å¯¹è¿™æ¬¡æœåŠ¡çš„æ„Ÿå—..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" @click="cancelBookingEvaluate">å–æ¶ˆ</button>
          <button class="btn btn-primary" @click="saveBookingEvaluate">æäº¤è¯„ä»·</button>
        </div>
      </div>
    </div>



  <!-- ä¿®æ”¹å¯†ç æ¨¡æ€æ¡† -->
    <div v-if="showChangePasswordModal" class="modal-overlay" @click="cancelChangePassword">
      <div class="modal-content" @click.stop>
        <div class="modal-header">
          <h3>ä¿®æ”¹å¯†ç </h3>
          <button class="close-btn" @click="cancelChangePassword">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>åŸå¯†ç ï¼š</label>
            <input 
              type="password" 
              v-model="changePasswordForm.oldPassword" 
              class="form-input" 
              placeholder="è¯·è¾“å…¥åŸå¯†ç "
              :class="{ 'error': passwordErrors.oldPassword }"
            >
            <span v-if="passwordErrors.oldPassword" class="error-message">{{ passwordErrors.oldPassword }}</span>
          </div>
          <div class="form-group">
            <label>æ–°å¯†ç ï¼š</label>
            <input 
              type="password" 
              v-model="changePasswordForm.newPassword" 
              class="form-input" 
              placeholder="è¯·è¾“å…¥æ–°å¯†ç "
              :class="{ 'error': passwordErrors.newPassword }"
            >
            <span v-if="passwordErrors.newPassword" class="error-message">{{ passwordErrors.newPassword }}</span>
            <div class="password-hint">å¯†ç è‡³å°‘åŒ…å«8ä¸ªå­—ç¬¦ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—</div>
          </div>
          <div class="form-group">
            <label>ç¡®è®¤æ–°å¯†ç ï¼š</label>
            <input 
              type="password" 
              v-model="changePasswordForm.confirmPassword" 
              class="form-input" 
              placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç "
              :class="{ 'error': passwordErrors.confirmPassword }"
            >
            <span v-if="passwordErrors.confirmPassword" class="error-message">{{ passwordErrors.confirmPassword }}</span>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" @click="cancelChangePassword">å–æ¶ˆ</button>
          <button class="btn btn-primary" @click="saveChangePassword">ä¿å­˜ä¿®æ”¹</button>
        </div>
      </div>
    </div>

    <!-- ä¸ªäººä¿¡æ¯æ¨¡æ€æ¡† -->
    <div v-if="showPersonalInfoModal" class="modal-overlay" @click="cancelPersonalInfo">
      <div class="modal-content personal-info-modal" @click.stop>
        <div class="modal-header">
          <h3>ä¸ªäººä¿¡æ¯</h3>
          <button class="close-btn" @click="cancelPersonalInfo">Ã—</button>
        </div>
        <div class="modal-body">
          <form class="personal-info-form" @submit.prevent="savePersonalInfo">
            <!-- å¤´åƒ -->
            <div class="form-group avatar-group">
              <label class="form-label">å¤´åƒ</label>
              <div class="avatar-section">
                <div class="avatar-container" @click="triggerAvatarUpload">
                  <img 
                    v-if="personalInfoForm.avatar" 
                    :src="personalInfoForm.avatar" 
                    alt="å¤´åƒ" 
                    class="avatar-image"
                  >
                  <div v-else class="avatar-placeholder">
                    <div class="avatar-icon">ğŸ»</div>
                  </div>
                  <input 
                    ref="avatarInput"
                    type="file" 
                    accept="image/*" 
                    @change="handleAvatarUpload"
                    style="display: none"
                  >
                </div>
              </div>
            </div>

            <!-- ç”¨æˆ·å -->
            <div class="form-group">
              <label class="form-label">ç”¨æˆ·å</label>
              <input 
                type="text" 
                v-model="personalInfoForm.username"
                class="form-input readonly"
                readonly
              >
            </div>

            <!-- å§“å -->
            <div class="form-group">
              <label class="form-label">å§“å</label>
              <input 
                type="text" 
                v-model="personalInfoForm.name"
                placeholder="è¯·è¾“å…¥å§“å"
                class="form-input"
                maxlength="20"
              >
            </div>

            <!-- ç”µè¯ -->
            <div class="form-group">
              <label class="form-label">ç”µè¯</label>
              <input 
                type="tel" 
                v-model="personalInfoForm.phone"
                placeholder="è¯·è¾“å…¥ç”µè¯å·ç "
                class="form-input"
                maxlength="11"
              >
            </div>

            <!-- é‚®ç®± -->
            <div class="form-group">
              <label class="form-label">é‚®ç®±</label>
              <input 
                type="email" 
                v-model="personalInfoForm.email"
                placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€"
                class="form-input"
                maxlength="50"
              >
            </div>

            <!-- è´¦æˆ·ä½™é¢ -->
            <div class="form-group">
              <label class="form-label">è´¦æˆ·ä½™é¢</label>
              <div class="balance-display">
                <span class="balance-amount">{{ personalInfoForm.balance }}å…ƒ</span>
              </div>
            </div>

            <!-- ä¿å­˜æŒ‰é’® -->
            <div class="form-actions">
              <button type="submit" class="save-btn">ä¿å­˜</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- å……å€¼è®°å½•æ¨¡æ€æ¡† -->
    <div v-if="showRechargeRecordModal" class="modal-overlay" @click="cancelRechargeRecord">
      <div class="modal-content recharge-record-modal" @click.stop>
        <div class="modal-header">
          <h3>æˆ‘çš„å……å€¼è®°å½•</h3>
          <button class="close-btn" @click="cancelRechargeRecord">Ã—</button>
        </div>
        <div class="modal-body">
          <!-- å……å€¼æ“ä½œåŒºåŸŸ -->
          <div class="recharge-actions">
            <button class="recharge-btn" @click="handleRecharge">æˆ‘è¦å……å€¼</button>
            <div class="balance-info">
              <span class="balance-label">å½“å‰è´¦æˆ·ä½™é¢:</span>
              <span class="balance-amount">Â¥{{ currentBalance }}</span>
            </div>
          </div>
          
          <!-- å……å€¼è®°å½•è¡¨æ ¼ -->
          <div class="recharge-table-container">
            <table class="recharge-table">
              <thead>
                <tr>
                  <th>é‡‘é¢</th>
                  <th>è´¦æˆ·ç±»å‹</th>
                  <th>è´¦å·</th>
                  <th>å……å€¼æ—¶é—´</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="record in paginatedRecords" :key="record.id" class="record-row">
                  <td class="amount">Â¥{{ record.amount }}</td>
                  <td class="account-type">{{ record.accountType }}</td>
                  <td class="account-number">{{ record.accountNumber }}</td>
                  <td class="recharge-time">{{ record.rechargeTime }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- åˆ†é¡µæ§ä»¶ -->
          <div class="pagination">
            <div class="pagination-info">
              å…±{{ totalRecords }}æ¡
            </div>
            <div class="pagination-controls">
              <button 
                class="page-btn" 
                @click="goToPage(currentPage - 1)"
                :disabled="currentPage === 1"
              >
                &lt;
              </button>
              <button 
                v-for="page in totalPages" 
                :key="page"
                class="page-btn"
                :class="{ active: page === currentPage }"
                @click="goToPage(page)"
              >
                {{ page }}
              </button>
              <button 
                class="page-btn" 
                @click="goToPage(currentPage + 1)"
                :disabled="currentPage === totalPages"
              >
                &gt;
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- å……å€¼ä¿¡æ¯æ¨¡æ€æ¡† -->
    <div v-if="showRechargeInfoModal" class="modal-overlay" @click="cancelRechargeInfo">
      <div class="modal-content recharge-info-modal" @click.stop>
        <div class="modal-header">
          <h3>å……å€¼ä¿¡æ¯</h3>
          <button class="close-btn" @click="cancelRechargeInfo">Ã—</button>
        </div>
        <div class="modal-body">
          <form class="recharge-info-form" @submit.prevent="confirmRecharge">
            <!-- å……å€¼é‡‘é¢ -->
            <div class="form-group">
              <label class="form-label">å……å€¼é‡‘é¢ <span class="required">*</span></label>
              <div class="amount-input-wrapper">
                <button type="button" class="amount-btn decrease" @click="decreaseAmount">-</button>
                <input 
                  type="number" 
                  v-model="rechargeInfoForm.amount"
                  placeholder="é‡‘é¢"
                  class="form-input amount-input"
                  min="1"
                  max="10000"
                  step="1"
                >
                <button type="button" class="amount-btn increase" @click="increaseAmount">+</button>
              </div>
            </div>

            <!-- æ”¯ä»˜è´¦å· -->
            <div class="form-group">
              <label class="form-label">æ”¯ä»˜è´¦å· <span class="required">*</span></label>
              <input 
                type="text" 
                v-model="rechargeInfoForm.paymentAccount"
                placeholder="æ”¯ä»˜è´¦å·"
                class="form-input"
                maxlength="20"
              >
            </div>

            <!-- æ”¯ä»˜æ–¹å¼ -->
            <div class="form-group">
              <label class="form-label">æ”¯ä»˜æ–¹å¼</label>
              <div class="payment-methods">
                <div class="payment-option">
                  <input 
                    type="radio" 
                    id="wechat" 
                    value="å¾®ä¿¡æ”¯ä»˜" 
                    v-model="rechargeInfoForm.paymentMethod"
                    class="payment-radio"
                  >
                  <label for="wechat" class="payment-label">
                    <div class="payment-icon wechat-icon">ğŸ’š</div>
                    <div class="payment-text">
                      <div class="payment-name">å¾®ä¿¡æ”¯ä»˜</div>
                      <div class="payment-subtitle">Wechat Pay</div>
                    </div>
                  </label>
                </div>
                <div class="payment-option">
                  <input 
                    type="radio" 
                    id="alipay" 
                    value="æ”¯ä»˜å®" 
                    v-model="rechargeInfoForm.paymentMethod"
                    class="payment-radio"
                  >
                  <label for="alipay" class="payment-label">
                    <div class="payment-icon alipay-icon">ğŸ”µ</div>
                    <div class="payment-text">
                      <div class="payment-name">æ”¯ä»˜å®</div>
                      <div class="payment-subtitle">ALIPAY</div>
                    </div>
                  </label>
                </div>
              </div>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" @click="cancelRechargeInfo">å–æ¶ˆ</button>
              <button type="submit" class="btn btn-primary">ç¡®å®š</button>
            </div>
          </form>
        </div>
        </div>
      </div>


    </div>
  </template>

<script setup lang="ts">
import { ref, computed, onMounted, onBeforeUnmount } from 'vue'
import { useRouter } from 'vue-router'
import { categoryAPI, serviceAPI, userAPI, removeToken, getToken } from '@/utils/api'

interface ServiceCategoryOption {
  id: string
  name: string
}

interface ServiceCard {
  id: number
  name: string
  description: string
  price: number
  unit: string
  booked: number
  categoryId: number | null
}

type ServiceQueryMode = 'popular' | 'category' | 'search'

interface ServicePageInfo {
  total: number
  current: number
  size: number
  pages: number
}

const router = useRouter()

// ç”¨æˆ·ä¿¡æ¯
const userInfo = ref({
  username: 'ç”¨æˆ·',
  role: 'user'
})

const userAvatar = ref('')

const personalInfoForm = ref({
  avatar: '',
  username: '',
  name: '',
  phone: '',
  email: '',
  balance: '0.00'
})

const currentBalance = ref(0)

const initializeUser = (): boolean => {
  const token = getToken()
  if (!token) {
    router.replace('/login')
    return false
  }

  const storedUserInfo = localStorage.getItem('userInfo')
  if (!storedUserInfo) {
    router.replace('/login')
    return false
  }

  try {
    const parsed = JSON.parse(storedUserInfo)
    if (parsed.role !== 'user') {
      router.replace('/login')
      return false
    }

    const storedUserData = parsed.userData || {}
    const displayName = storedUserData.realName || parsed.username || 'ç”¨æˆ·'

    userInfo.value = {
      username: displayName,
      role: parsed.role
    }

    if (storedUserData.avatar) {
      userAvatar.value = storedUserData.avatar
    }

    const balanceValue = Number(storedUserData.balance ?? 0)
    currentBalance.value = Number.isNaN(balanceValue) ? 0 : balanceValue

    personalInfoForm.value = {
      avatar: storedUserData.avatar || '',
      username: storedUserData.username || parsed.username || '',
      name: displayName,
      phone: storedUserData.phone || '',
      email: storedUserData.email || '',
      balance: Number.isNaN(balanceValue) ? '0.00' : balanceValue.toFixed(2)
    }

    return true
  } catch (error) {
    console.error('è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)
    localStorage.removeItem('userInfo')
    router.replace('/login')
    return false
  }
}

const fetchUserProfile = async () => {
  try {
    const response = await userAPI.getUserInfo()
    if (response?.data) {
      const user = response.data
      const displayName = user.realName || user.username || userInfo.value.username

      userInfo.value.username = displayName

      personalInfoForm.value = {
        avatar: user.avatar || '',
        username: user.username || '',
        name: displayName,
        phone: user.phone || '',
        email: user.email || '',
        balance: Number(user.balance ?? 0).toFixed(2)
      }

      const balanceValue = Number(user.balance ?? 0)
      currentBalance.value = Number.isNaN(balanceValue) ? 0 : balanceValue

      if (user.avatar) {
        userAvatar.value = user.avatar
      }
    }
  } catch (error) {
    console.error('åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)
  }
}

// å½“å‰æ¿€æ´»çš„èœå•
const activeMenu = ref('home')

// ç”¨æˆ·ä¸‹æ‹‰èœå•æ˜¾ç¤ºçŠ¶æ€
const showUserDropdown = ref(false)

// ä¿®æ”¹å¯†ç ç›¸å…³
const showChangePasswordModal = ref(false)
const changePasswordForm = ref({
  oldPassword: '',
  newPassword: '',
  confirmPassword: ''
})
const passwordErrors = ref({
  oldPassword: '',
  newPassword: '',
  confirmPassword: ''
})

// ä¸ªäººä¿¡æ¯ç›¸å…³
const showPersonalInfoModal = ref(false)

// å¤´åƒè¾“å…¥æ¡†å¼•ç”¨
const avatarInput = ref<HTMLInputElement | null>(null)

// å……å€¼è®°å½•ç›¸å…³
const showRechargeRecordModal = ref(false)
const currentPage = ref(1)
const pageSize = ref(5)

// å……å€¼ä¿¡æ¯ç›¸å…³
const showRechargeInfoModal = ref(false)
const rechargeInfoForm = ref({
  amount: 100,
  paymentAccount: '',
  paymentMethod: 'å¾®ä¿¡æ”¯ä»˜'
})


// æ¨¡æ‹Ÿå……å€¼è®°å½•æ•°æ®
const rechargeRecords = ref([
  {
    id: 1,
    amount: 500,
    accountType: 'æ”¯ä»˜å®',
    accountNumber: '13900889977',
    rechargeTime: '2025-05-22 22:31:18'
  },
  {
    id: 2,
    amount: 1000,
    accountType: 'æ”¯ä»˜å®',
    accountNumber: '13988997788',
    rechargeTime: '2025-05-21 09:09:20'
  },
  {
    id: 3,
    amount: 1000,
    accountType: 'å¾®ä¿¡æ”¯ä»˜',
    accountNumber: '13988997788',
    rechargeTime: '2025-05-21 08:56:57'
  },
  {
    id: 4,
    amount: 500,
    accountType: 'æ”¯ä»˜å®',
    accountNumber: '13900889977',
    rechargeTime: '2025-05-20 08:56:36'
  },
  {
    id: 5,
    amount: 1000,
    accountType: 'æ”¯ä»˜å®',
    accountNumber: '13988997788',
    rechargeTime: '2025-05-18 12:03:06'
  },
  {
    id: 6,
    amount: 200,
    accountType: 'å¾®ä¿¡æ”¯ä»˜',
    accountNumber: '13900889977',
    rechargeTime: '2025-05-15 14:20:15'
  },
  {
    id: 7,
    amount: 800,
    accountType: 'æ”¯ä»˜å®',
    accountNumber: '13988997788',
    rechargeTime: '2025-05-12 10:15:30'
  },
  {
    id: 8,
    amount: 300,
    accountType: 'å¾®ä¿¡æ”¯ä»˜',
    accountNumber: '13900889977',
    rechargeTime: '2025-05-10 16:45:22'
  },
  {
    id: 9,
    amount: 1500,
    accountType: 'æ”¯ä»˜å®',
    accountNumber: '13988997788',
    rechargeTime: '2025-05-08 09:30:45'
  },
  {
    id: 10,
    amount: 600,
    accountType: 'å¾®ä¿¡æ”¯ä»˜',
    accountNumber: '13900889977',
    rechargeTime: '2025-05-05 13:25:18'
  },
  {
    id: 11,
    amount: 1200,
    accountType: 'æ”¯ä»˜å®',
    accountNumber: '13988997788',
    rechargeTime: '2025-05-02 11:40:33'
  },
  {
    id: 12,
    amount: 400,
    accountType: 'å¾®ä¿¡æ”¯ä»˜',
    accountNumber: '13900889977',
    rechargeTime: '2025-04-30 15:55:07'
  }
])

// å……å€¼è®°å½•è®¡ç®—å±æ€§
const totalRecords = computed(() => rechargeRecords.value.length)
const totalPages = computed(() => Math.ceil(totalRecords.value / pageSize.value))
const paginatedRecords = computed(() => {
  const start = (currentPage.value - 1) * pageSize.value
  const end = start + pageSize.value
  return rechargeRecords.value.slice(start, end)
})

// å°è´´å£«æœç´¢å…³é”®è¯
const tipsSearchKeyword = ref('')

// é¢„çº¦æœç´¢å…³é”®è¯
const bookingSearchKeyword = ref('')

// è¯„ä»·æœç´¢å…³é”®è¯
const reviewsSearchKeyword = ref('')

// æœåŠ¡æœç´¢å…³é”®è¯
const serviceSearchKeyword = ref('')

const servicePageSize = 12

const filteredServices = ref<ServiceCard[]>([])
const servicePageInfo = ref<ServicePageInfo>({
  total: 0,
  current: 1,
  size: servicePageSize,
  pages: 0
})

const serviceCategories = ref<ServiceCategoryOption[]>([{ id: 'all', name: 'å…¨éƒ¨' }])
const activeCategory = ref<string>('all')
const isCategoryLoading = ref(false)
const categoryErrorMessage = ref('')
const isServiceLoading = ref(false)
const serviceErrorMessage = ref('')
const lastServiceQuery = ref<{ mode: ServiceQueryMode; categoryId?: string; keyword?: string }>({ mode: 'popular' })
let serviceSearchTimer: ReturnType<typeof setTimeout> | null = null

const mapServiceRecord = (record: any): ServiceCard => ({
  id: Number(record?.id ?? 0),
  name: record?.name || 'æœªå‘½åæœåŠ¡',
  description: record?.description || record?.content || 'æš‚æ— æè¿°',
  price: Number(record?.price ?? 0),
  unit: record?.unit || 'æ¬¡',
  booked: Number(record?.bookingCount ?? record?.booked ?? 0),
  categoryId: typeof record?.categoryId === 'number'
    ? record.categoryId
    : record?.categoryId
      ? Number(record.categoryId)
      : null
})

const loadServices = async (
  fetcher: () => Promise<any>,
  mode: ServiceQueryMode,
  payload: { categoryId?: string; keyword?: string } = {},
  page = 1
) => {
  isServiceLoading.value = true
  serviceErrorMessage.value = ''
  try {
    const response = await fetcher()
    const pageData = response?.data
    const records = Array.isArray(pageData?.records)
      ? pageData.records
      : Array.isArray(pageData)
        ? pageData
        : []

    filteredServices.value = records.map(mapServiceRecord)

    const total = typeof pageData?.total === 'number' ? pageData.total : filteredServices.value.length
    const size = typeof pageData?.size === 'number' ? pageData.size : servicePageSize
    const pages =
      typeof pageData?.pages === 'number'
        ? pageData.pages
        : total > 0
          ? Math.ceil(total / size)
          : 0

    servicePageInfo.value = {
      total,
      current: page,
      size,
      pages
    }

    lastServiceQuery.value = { mode, ...payload }
  } catch (error: any) {
    console.error('åŠ è½½æœåŠ¡å¤±è´¥:', error)
    serviceErrorMessage.value = error?.message || 'æœåŠ¡åŠ è½½å¤±è´¥'
    filteredServices.value = []
    servicePageInfo.value = {
      total: 0,
      current: 1,
      size: servicePageSize,
      pages: 0
    }
  } finally {
    isServiceLoading.value = false
  }
}

const fetchPopularServices = async (page = 1) => {
  await loadServices(
    () => serviceAPI.getPopularServices(page, servicePageSize),
    'popular',
    {},
    page
  )
}

const fetchServicesByCategory = async (categoryId: string, page = 1) => {
  if (categoryId === 'all') {
    await fetchPopularServices(page)
    return
  }

  const numericId = Number(categoryId)
  if (Number.isNaN(numericId)) {
    serviceErrorMessage.value = 'æ— æ•ˆçš„åˆ†ç±»ID'
    filteredServices.value = []
    servicePageInfo.value = {
      total: 0,
      current: 1,
      size: servicePageSize,
      pages: 0
    }
    return
  }

  await loadServices(
    () => serviceAPI.getServicesByCategory(numericId, page, servicePageSize),
    'category',
    { categoryId },
    page
  )
}

const searchServices = async (page = 1, keywordParam?: string) => {
  const keyword = keywordParam ?? serviceSearchKeyword.value.trim()

  if (!keyword) {
    await fetchServicesByCategory(activeCategory.value, page)
    return
  }

  serviceSearchKeyword.value = keyword

  await loadServices(
    () => serviceAPI.searchServices(keyword, page, servicePageSize),
    'search',
    { keyword },
    page
  )
}

const clearServiceSearch = async () => {
  serviceSearchKeyword.value = ''
  await fetchServicesByCategory(activeCategory.value, 1)
}

const handleServiceSearchInput = () => {
  if (serviceSearchTimer) {
    clearTimeout(serviceSearchTimer)
  }

  serviceSearchTimer = window.setTimeout(() => {
    searchServices()
  }, 400)
}

const selectCategory = async (categoryId: string) => {
  activeCategory.value = categoryId
  serviceSearchKeyword.value = ''
  await fetchServicesByCategory(categoryId, 1)
}

const fetchCategories = async () => {
  isCategoryLoading.value = true
  categoryErrorMessage.value = ''
  try {
    const response = await categoryAPI.getPublicCategories()
    const categories = Array.isArray(response?.data) ? response.data : []

    const normalized = categories.map((category: any): ServiceCategoryOption => ({
      id: String(category?.id),
      name: category?.name || 'æœªå‘½ååˆ†ç±»'
    }))

    serviceCategories.value = [
      { id: 'all', name: 'å…¨éƒ¨' },
      ...normalized
    ]
  } catch (error: any) {
    console.error('åŠ è½½åˆ†ç±»å¤±è´¥:', error)
    categoryErrorMessage.value = error?.message || 'æœåŠ¡åˆ†ç±»åŠ è½½å¤±è´¥'
    serviceCategories.value = [{ id: 'all', name: 'å…¨éƒ¨' }]
  } finally {
    isCategoryLoading.value = false
  }
}

const handleServiceSectionActivation = () => {
  if (filteredServices.value.length === 0 && !isServiceLoading.value) {
    fetchServicesByCategory(activeCategory.value, 1)
  }
}

const changeServicePage = async (page: number) => {
  if (page < 1 || page === servicePageInfo.value.current) {
    return
  }

  if (servicePageInfo.value.pages > 0 && page > servicePageInfo.value.pages) {
    return
  }

  const query = lastServiceQuery.value

  if (query.mode === 'search' && query.keyword) {
    await searchServices(page, query.keyword)
  } else if (query.mode === 'category' && query.categoryId) {
    await fetchServicesByCategory(query.categoryId, page)
  } else {
    await fetchPopularServices(page)
  }
}

// å°è´´å£«æ•°æ®
const allTips = ref([
  {
    id: 1,
    title: 'è®©ç”Ÿæ´»ç©ºé—´ç„•ç„¶ä¸€æ–°',
    content: 'å¨æˆ¿æ˜¯å®¶ä¸­æ²¹æ±¡çš„"é‡ç¾åŒº",ä½†æŒæ¡ä¸€äº›æ¸…æ´æŠ€å·§,å°±èƒ½è½»æ¾åº”å¯¹ã€‚å¯¹äºé¡½å›ºçš„ç¶å°æ²¹æ±¡,æˆ‘ä»¬å¯ä»¥è‡ªåˆ¶æ¸…æ´ç¥å™¨ã€‚',
    views: 33,
    date: '2025-05-09 15:56:24',
    image: 'https://via.placeholder.com/120x80/ff6b6b/ffffff?text=æ¸…æ´'
  },
  {
    id: 2,
    title: 'æ‰“é€ äº•äº•æœ‰æ¡çš„å®¶',
    content: 'è¡£ç‰©æ”¶çº³è¦æ ¹æ®å­£èŠ‚å’Œä½¿ç”¨é¢‘ç‡è¿›è¡Œåˆ†ç±»ã€‚å¯¹äºä¸å¸¸ç©¿çš„è¿‡å­£è¡£ç‰©,å¯ä»¥ä½¿ç”¨çœŸç©ºå‹ç¼©è¢‹æ”¶çº³,è¿™æ ·ä¸ä»…èƒ½èŠ‚çœç©ºé—´,è¿˜èƒ½é˜²æ­¢è¡£ç‰©å—æ½®å‘éœ‰ã€‚',
    views: 6,
    date: '2025-05-09 15:56:24',
    image: 'https://via.placeholder.com/120x80/4ecdc4/ffffff?text=æ”¶çº³'
  },
  {
    id: 3,
    title: 'å®ˆæŠ¤å®¶äººçš„å¹³å®‰',
    content: 'å®¶ä¸­çš„ç”µå™¨ä½¿ç”¨é¢‘ç¹,ç”¨ç”µå®‰å…¨è‡³å…³é‡è¦ã€‚è¦å®šæœŸæ£€æŸ¥ç”µå™¨çº¿è·¯,é¿å…ç”µçº¿è€åŒ–ã€ç ´æŸã€‚ä¸ä½¿ç”¨ç”µå™¨æ—¶,è¦åŠæ—¶æ‹”æ‰æ’å¤´,é¿å…å¾…æœºçŠ¶æ€ä¸‹çš„è€—ç”µå’Œå®‰å…¨éšæ‚£ã€‚',
    views: 1,
    date: '2025-05-09 15:56:24',
    image: 'https://via.placeholder.com/120x80/45b7d1/ffffff?text=å®‰å…¨'
  },
  {
    id: 4,
    title: 'å«ç”Ÿé—´æ·±åº¦æ¸…æ´æŒ‡å—:è®©å«æµ´ç©ºé—´ç„•æ–°å¦‚åˆ',
    content: 'å«ç”Ÿé—´ä½œä¸ºå®¶ä¸­ä½¿ç”¨é¢‘ç‡æé«˜çš„åŒºåŸŸ,ææ˜“è—æ±¡çº³å¢,ä¸ä»…å½±å“ç¾è§‚,è¿˜å¯èƒ½æ»‹ç”Ÿå¤§é‡ç»†èŒ,å±å®³å®¶äººå¥åº·ã€‚æŒæ¡ç§‘å­¦æœ‰æ•ˆçš„æ¸…æ´æ–¹æ³•,èƒ½è®©å«ç”Ÿé—´æ—¶åˆ»ä¿æŒå¹²å‡€æ•´æ´,ä¸ºç”Ÿæ´»å¸¦æ¥èˆ’é€‚ä¸å®‰å¿ƒ',
    views: 2,
    date: '2025-05-09 15:56:24',
    image: 'https://via.placeholder.com/120x80/96ceb4/ffffff?text=å«ç”Ÿé—´'
  }
])

// è¿‡æ»¤åçš„å°è´´å£«æ•°æ®
const filteredTips = ref([...allTips.value])

// é¢„çº¦æ•°æ®
const allBookings = ref([
  {
    id: 1,
    serviceName: 'æ–°æˆ¿ç²¾ç»†å¼€è’1å¹³ç±³ã€åŒ…è¿é€åƒåœ¾/åŒ…éªŒæ”¶ã€‘',
    quantity: 1,
    totalAmount: 9.9,
    serviceProvider: 'å®¶æ”¿å°ä¸',
    contactPhone: 'å¼ é£',
    contactAddress: 'æ«å¶ç¤¾åŒº...',
    serviceProviderPhone: '13988997788',
    status: 'completed',
    startTime: '2025-05-09',
    endTime: '2025-05-09',
    appointmentTime: '2025-05-08'
  },
  {
    id: 2,
    serviceName: 'åœ°æ¿æ‰“èœ¡10å¹³ç±³',
    quantity: 1,
    totalAmount: 66,
    serviceProvider: 'å®¶æ”¿å°æ•',
    contactPhone: '13988997788',
    contactAddress: 'æ«å¶ç¤¾åŒº...',
    serviceProviderPhone: '13988997788',
    status: 'completed',
    startTime: '2025-05-09',
    endTime: '2025-05-09',
    appointmentTime: '2025-05-08'
  },
  {
    id: 3,
    serviceName: 'åœ°æ¿æ‰“èœ¡10å¹³ç±³',
    quantity: 1,
    totalAmount: 66,
    serviceProvider: '',
    contactPhone: '13999887788',
    contactAddress: 'åˆè‚¥å¸‚æ«...',
    serviceProviderPhone: '',
    status: 'pending',
    startTime: '2025-05-10',
    endTime: '2025-05-10',
    appointmentTime: ''
  },
  {
    id: 4,
    serviceName: 'å¨æˆ¿ä¿å…»æ¸…æ´ã€åŒ…å«æ²¹çƒŸæœºã€‘',
    quantity: 1,
    totalAmount: 338,
    serviceProvider: 'å®¶æ”¿å°é»„',
    contactPhone: '13900998877',
    contactAddress: 'åˆè‚¥å¸‚æ«...',
    serviceProviderPhone: '13988993377',
    status: 'in-service',
    startTime: '2025-05-10',
    endTime: '2025-05-10',
    appointmentTime: ''
  },
  {
    id: 5,
    serviceName: 'æ·±åº¦ä¿æ´5å°æ—¶ã€å…¨å±‹å¤§æ‰«é™¤ã€‘',
    quantity: 2,
    totalAmount: 1076,
    serviceProvider: 'å®¶æ”¿å°é»„',
    contactPhone: '',
    contactAddress: '',
    serviceProviderPhone: '',
    status: 'completed',
    startTime: '2025-05-11',
    endTime: '2025-05-11',
    appointmentTime: '2025-05-10'
  }
])

// è¿‡æ»¤åçš„é¢„çº¦æ•°æ®
const filteredBookings = ref([...allBookings.value])

// è¯„ä»·æ•°æ®
const allReviews = ref([
  {
    id: 1,
    serviceProvider: 'å®¶æ”¿å°ä¸',
    serviceName: 'æ–°æˆ¿ç²¾ç»†å¼€è’1å¹³ç±³ã€åŒ…è¿é€åƒåœ¾/åŒ…éªŒæ”¶ã€‘',
    rating: 5,
    content: 'éå¸¸å¥½',
    reviewTime: '2025-05-17 22:51:47'
  },
  {
    id: 2,
    serviceProvider: 'å®¶æ”¿å°æ•',
    serviceName: 'åœ°æ¿æ‰“èœ¡10å¹³ç±³',
    rating: 4.5,
    content: 'æˆ‘å¾ˆæ»¡æ„!',
    reviewTime: '2025-05-17 22:29:12'
  },
  {
    id: 3,
    serviceProvider: 'å®¶æ”¿å°æœˆ',
    serviceName: 'æ²™å‘ä¿å…»æ¸…æ´ã€åŒ…å«çš®é©å…»æŠ¤ã€‘',
    rating: 4,
    content: 'å¾ˆå¥½!',
    reviewTime: '2025-05-17 22:29:12'
  },
  {
    id: 4,
    serviceProvider: 'å®¶æ”¿å°é»„',
    serviceName: 'æ·±åº¦ä¿æ´5å°æ—¶ã€å…¨å±‹å¤§æ‰«é™¤ã€‘',
    rating: 4.5,
    content: 'éå¸¸å¥½!',
    reviewTime: '2025-05-13 09:00:00'
  },
  {
    id: 5,
    serviceProvider: 'å®¶æ”¿å°ä¸',
    serviceName: '4å°æ—¶å…¨å±‹æ—¥å¸¸ä¿æ´ã€ä¸­ç­‰æˆ·å‹æ¨èã€‘å¿«é€Ÿä¸Šé—¨',
    rating: 3.5,
    content: 'éå¸¸å¥½!',
    reviewTime: '2025-05-09 16:45:17'
  }
])

// è¿‡æ»¤åçš„è¯„ä»·æ•°æ®
const filteredReviews = ref([...allReviews.value])

// è¯„ä»·ç¼–è¾‘ç›¸å…³
const showReviewModal = ref(false)
const editingReview = ref<any>(null)
const reviewForm = ref({
  serviceProvider: '',
  serviceName: '',
  rating: 5,
  content: ''
})

// é¢„çº¦è¯„ä»·ç›¸å…³
const showBookingEvaluateModal = ref(false)
const evaluatingBooking = ref<any>(null)
const bookingEvaluateForm = ref({
  rating: 5,
  content: ''
})

// é¢„çº¦è¡¨å•ç›¸å…³
const bookingForm = ref({
  serviceType: '',
  date: '',
  time: '',
  duration: '',
  notes: ''
})


// è®¾ç½®æ¿€æ´»èœå•
const setActiveMenu = (menu: string) => {
  activeMenu.value = menu

  if (menu === 'services') {
    handleServiceSectionActivation()
  }
}

// å°è´´å£«æœç´¢åŠŸèƒ½
const searchTips = () => {
  const keyword = tipsSearchKeyword.value.trim().toLowerCase()
  if (keyword === '') {
    filteredTips.value = [...allTips.value]
  } else {
    filteredTips.value = allTips.value.filter(tip => 
      tip.title.toLowerCase().includes(keyword) ||
      tip.content.toLowerCase().includes(keyword)
    )
  }
}

// æ¸…ç©ºå°è´´å£«æœç´¢
const clearTipsSearch = () => {
  tipsSearchKeyword.value = ''
  filteredTips.value = [...allTips.value]
}

// æäº¤é¢„çº¦
const submitBooking = () => {
  console.log('æäº¤é¢„çº¦:', bookingForm.value)
  alert('é¢„çº¦æäº¤æˆåŠŸï¼æˆ‘ä»¬ä¼šå°½å¿«ä¸æ‚¨è”ç³»ã€‚')
  // é‡ç½®è¡¨å•
  bookingForm.value = {
    serviceType: '',
    date: '',
    time: '',
    duration: '',
    notes: ''
  }
}


// é¢„çº¦æœç´¢åŠŸèƒ½
const searchBookings = () => {
  const keyword = bookingSearchKeyword.value.trim().toLowerCase()
  if (keyword === '') {
    filteredBookings.value = [...allBookings.value]
  } else {
    filteredBookings.value = allBookings.value.filter(booking => 
      booking.serviceName.toLowerCase().includes(keyword) ||
      booking.serviceProvider.toLowerCase().includes(keyword) ||
      booking.contactPhone.toLowerCase().includes(keyword) ||
      booking.contactAddress.toLowerCase().includes(keyword)
    )
  }
}

// æ¸…ç©ºé¢„çº¦æœç´¢
const clearBookingSearch = () => {
  bookingSearchKeyword.value = ''
  filteredBookings.value = [...allBookings.value]
}

// è¯„ä»·æœç´¢åŠŸèƒ½
const searchReviews = () => {
  const keyword = reviewsSearchKeyword.value.trim().toLowerCase()
  if (keyword === '') {
    filteredReviews.value = [...allReviews.value]
  } else {
    filteredReviews.value = allReviews.value.filter(review => 
      review.serviceProvider.toLowerCase().includes(keyword) ||
      review.serviceName.toLowerCase().includes(keyword) ||
      review.content.toLowerCase().includes(keyword)
    )
  }
}

// æ¸…ç©ºè¯„ä»·æœç´¢
const clearReviewsSearch = () => {
  reviewsSearchKeyword.value = ''
  filteredReviews.value = [...allReviews.value]
}

// ç¼–è¾‘è¯„ä»·
const editReview = (review: any) => {
  editingReview.value = review
  reviewForm.value = {
    serviceProvider: review.serviceProvider,
    serviceName: review.serviceName,
    rating: review.rating,
    content: review.content
  }
  showReviewModal.value = true
}

// åˆ é™¤è¯„ä»·
const deleteReview = (reviewId: number) => {
  if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„ä»·å—ï¼Ÿ')) {
    const index = allReviews.value.findIndex(review => review.id === reviewId)
    if (index > -1) {
      allReviews.value.splice(index, 1)
      // é‡æ–°æœç´¢ä»¥æ›´æ–°æ˜¾ç¤º
      searchReviews()
    }
  }
}

// ä¿å­˜è¯„ä»·ç¼–è¾‘
const saveReviewEdit = () => {
  if (editingReview.value && editingReview.value.id) {
    const index = allReviews.value.findIndex(review => review.id === editingReview.value.id)
    if (index > -1) {
      allReviews.value[index] = {
        ...allReviews.value[index],
        serviceProvider: reviewForm.value.serviceProvider,
        serviceName: reviewForm.value.serviceName,
        rating: reviewForm.value.rating,
        content: reviewForm.value.content
      }
      // é‡æ–°æœç´¢ä»¥æ›´æ–°æ˜¾ç¤º
      searchReviews()
    }
  }
  showReviewModal.value = false
  editingReview.value = null
}

// å–æ¶ˆç¼–è¾‘
const cancelReviewEdit = () => {
  showReviewModal.value = false
  editingReview.value = null
  reviewForm.value = {
    serviceProvider: '',
    serviceName: '',
    rating: 5,
    content: ''
  }
}

// é¢„çº¦è¯„ä»·åŠŸèƒ½
const evaluateBooking = (booking: any) => {
  evaluatingBooking.value = booking
  bookingEvaluateForm.value = {
    rating: 5,
    content: ''
  }
  showBookingEvaluateModal.value = true
}

// ä¿å­˜é¢„çº¦è¯„ä»·
const saveBookingEvaluate = () => {
  if (evaluatingBooking.value) {
    // åˆ›å»ºæ–°çš„è¯„ä»·è®°å½•
    const newReview = {
      id: allReviews.value.length + 1,
      serviceProvider: (evaluatingBooking.value.serviceProvider || 'æœªçŸ¥æœåŠ¡è€…') as string,
      serviceName: (evaluatingBooking.value.serviceName || '') as string,
      rating: bookingEvaluateForm.value.rating,
      content: bookingEvaluateForm.value.content,
      reviewTime: new Date().toLocaleString('zh-CN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      }).replace(/\//g, '-')
    }
    
    // æ·»åŠ åˆ°è¯„ä»·åˆ—è¡¨
    allReviews.value.unshift(newReview)
    
    // æ›´æ–°é¢„çº¦çŠ¶æ€ä¸ºå·²è¯„ä»·
    if (evaluatingBooking.value.id !== undefined) {
      const bookingIndex = allBookings.value.findIndex(booking => booking.id === evaluatingBooking.value.id)
      if (bookingIndex > -1) {
        allBookings.value[bookingIndex].status = 'evaluated'
      }
    }
    
    // é‡æ–°æœç´¢ä»¥æ›´æ–°æ˜¾ç¤º
    searchBookings()
    searchReviews()
    
    alert('è¯„ä»·æäº¤æˆåŠŸï¼')
  }
  showBookingEvaluateModal.value = false
  evaluatingBooking.value = null
}

// å–æ¶ˆé¢„çº¦è¯„ä»·
const cancelBookingEvaluate = () => {
  showBookingEvaluateModal.value = false
  evaluatingBooking.value = null
  bookingEvaluateForm.value = {
    rating: 5,
    content: ''
  }
}

// å–æ¶ˆé¢„çº¦
const cancelBooking = (bookingId: number) => {
  if (confirm('ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªé¢„çº¦å—ï¼Ÿå–æ¶ˆåæ— æ³•æ¢å¤ã€‚')) {
    const index = allBookings.value.findIndex(booking => booking.id === bookingId)
    if (index > -1) {
      allBookings.value[index].status = 'cancelled'
      // é‡æ–°æœç´¢ä»¥æ›´æ–°æ˜¾ç¤º
      searchBookings()
    }
    alert('é¢„çº¦å·²å–æ¶ˆï¼')
  }
}

// å…¨é€‰/å–æ¶ˆå…¨é€‰
const toggleSelectAll = (event: Event) => {
  const target = event.target as HTMLInputElement
  const checkboxes = document.querySelectorAll('.row-checkbox') as NodeListOf<HTMLInputElement>
  checkboxes.forEach(checkbox => {
    checkbox.checked = target.checked
  })
}

// æ‰¹é‡åˆ é™¤
const batchDelete = () => {
  const selectedCheckboxes = document.querySelectorAll('.row-checkbox:checked')
  if (selectedCheckboxes.length === 0) {
    alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„è¯„ä»·è®°å½•')
    return
  }
  if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedCheckboxes.length} æ¡è¯„ä»·è®°å½•å—ï¼Ÿ`)) {
    alert('æ‰¹é‡åˆ é™¤æˆåŠŸï¼')
  }
}

// åˆ‡æ¢ç”¨æˆ·ä¸‹æ‹‰èœå•
const toggleUserDropdown = () => {
  showUserDropdown.value = !showUserDropdown.value
}

// å¤„ç†æˆ‘çš„æ”¶è—
const handleMyFavorites = () => {
  showUserDropdown.value = false
  alert('æˆ‘çš„æ”¶è—åŠŸèƒ½')
}

// å¤„ç†å……å€¼è®°å½•
const handleRechargeRecords = () => {
  showUserDropdown.value = false
  showRechargeRecordModal.value = true
}

// å¤„ç†ä¸ªäººä¿¡æ¯
const handlePersonalInfo = () => {
  showUserDropdown.value = false
  // æ˜¾ç¤ºä¸ªäººä¿¡æ¯æ¨¡æ€æ¡†
  showPersonalInfoModal.value = true
}

// å¤„ç†ä¿®æ”¹å¯†ç 
const handleChangePassword = () => {
  showUserDropdown.value = false
  // é‡ç½®è¡¨å•å’Œé”™è¯¯ä¿¡æ¯
  changePasswordForm.value = {
    oldPassword: '',
    newPassword: '',
    confirmPassword: ''
  }
  passwordErrors.value = {
    oldPassword: '',
    newPassword: '',
    confirmPassword: ''
  }
  // æ˜¾ç¤ºæ¨¡æ€æ¡†
  showChangePasswordModal.value = true
}

// éªŒè¯ä¿®æ”¹å¯†ç è¡¨å•
const validatePasswordForm = () => {
  let isValid = true
  
  // é‡ç½®é”™è¯¯ä¿¡æ¯
  passwordErrors.value = {
    oldPassword: '',
    newPassword: '',
    confirmPassword: ''
  }
  
  // éªŒè¯åŸå¯†ç 
  if (!changePasswordForm.value.oldPassword) {
    passwordErrors.value.oldPassword = 'è¯·è¾“å…¥åŸå¯†ç '
    isValid = false
  }
  
  // éªŒè¯æ–°å¯†ç 
  if (!changePasswordForm.value.newPassword) {
    passwordErrors.value.newPassword = 'è¯·è¾“å…¥æ–°å¯†ç '
    isValid = false
  } else if (changePasswordForm.value.newPassword.length < 8) {
    passwordErrors.value.newPassword = 'å¯†ç é•¿åº¦è‡³å°‘8ä¸ªå­—ç¬¦'
    isValid = false
  } else if (!/[a-zA-Z]/.test(changePasswordForm.value.newPassword) || !/[0-9]/.test(changePasswordForm.value.newPassword)) {
    passwordErrors.value.newPassword = 'å¯†ç å¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—'
    isValid = false
  } else if (changePasswordForm.value.newPassword === changePasswordForm.value.oldPassword) {
    passwordErrors.value.newPassword = 'æ–°å¯†ç ä¸èƒ½ä¸åŸå¯†ç ç›¸åŒ'
    isValid = false
  }
  
  // éªŒè¯ç¡®è®¤å¯†ç 
  if (!changePasswordForm.value.confirmPassword) {
    passwordErrors.value.confirmPassword = 'è¯·ç¡®è®¤æ–°å¯†ç '
    isValid = false
  } else if (changePasswordForm.value.confirmPassword !== changePasswordForm.value.newPassword) {
    passwordErrors.value.confirmPassword = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´'
    isValid = false
  }
  
  return isValid
}

// ä¿å­˜ä¿®æ”¹å¯†ç 
const saveChangePassword = () => {
  // éªŒè¯è¡¨å•
  if (!validatePasswordForm()) {
    return
  }
  
  // æ¨¡æ‹ŸAPIè°ƒç”¨
  console.log('ä¿®æ”¹å¯†ç è¯·æ±‚:', changePasswordForm.value)
  
  // æ¨¡æ‹ŸæˆåŠŸå“åº”
  setTimeout(() => {
    alert('å¯†ç ä¿®æ”¹æˆåŠŸï¼è¯·é‡æ–°ç™»å½•')
    // æ¸…é™¤ç”¨æˆ·ä¿¡æ¯å¹¶è·³è½¬åˆ°ç™»å½•é¡µ
    localStorage.removeItem('userInfo')
    window.location.href = '/login'
  }, 500)
}

// å–æ¶ˆä¿®æ”¹å¯†ç 
const cancelChangePassword = () => {
  showChangePasswordModal.value = false
  // é‡ç½®è¡¨å•å’Œé”™è¯¯ä¿¡æ¯
  changePasswordForm.value = {
    oldPassword: '',
    newPassword: '',
    confirmPassword: ''
  }
  passwordErrors.value = {
    oldPassword: '',
    newPassword: '',
    confirmPassword: ''
  }
}

// è§¦å‘å¤´åƒä¸Šä¼ 
const triggerAvatarUpload = () => {
  if (avatarInput.value) {
    avatarInput.value.click()
  }
}

// å¤„ç†å¤´åƒä¸Šä¼ 
const handleAvatarUpload = (event: Event) => {
  const target = event.target as HTMLInputElement
  const file = target.files?.[0]
  
  if (file) {
    // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆ2MBé™åˆ¶ï¼‰
    if (file.size > 2 * 1024 * 1024) {
      alert('å¤´åƒæ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡2MB')
      return
    }
    
    // æ£€æŸ¥æ–‡ä»¶ç±»å‹
    if (!file.type.startsWith('image/')) {
      alert('è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶')
      return
    }
    
    // åˆ›å»ºæ–‡ä»¶URLç”¨äºé¢„è§ˆ
    const reader = new FileReader()
    reader.onload = (e) => {
      personalInfoForm.value.avatar = e.target?.result as string
      // åŒæ­¥æ›´æ–°å³ä¸Šè§’å¤´åƒ
      userAvatar.value = e.target?.result as string
    }
    reader.readAsDataURL(file)
  }
}

// ä¿å­˜ä¸ªäººä¿¡æ¯
const savePersonalInfo = () => {
  // éªŒè¯å¿…å¡«å­—æ®µ
  if (!personalInfoForm.value.name.trim()) {
    alert('è¯·è¾“å…¥å§“å')
    return
  }
  
  if (!personalInfoForm.value.phone.trim()) {
    alert('è¯·è¾“å…¥ç”µè¯å·ç ')
    return
  }
  
  if (!personalInfoForm.value.email.trim()) {
    alert('è¯·è¾“å…¥é‚®ç®±åœ°å€')
    return
  }
  
  // éªŒè¯ç”µè¯å·ç æ ¼å¼
  const phoneRegex = /^1[3-9]\d{9}$/
  if (!phoneRegex.test(personalInfoForm.value.phone)) {
    alert('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç ')
    return
  }
  
  // éªŒè¯é‚®ç®±æ ¼å¼
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  if (!emailRegex.test(personalInfoForm.value.email)) {
    alert('è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±åœ°å€')
    return
  }
  
  // æ¨¡æ‹Ÿä¿å­˜
  console.log('ä¿å­˜ä¸ªäººä¿¡æ¯:', personalInfoForm.value)

  userInfo.value.username = personalInfoForm.value.name

  const storedInfo = localStorage.getItem('userInfo')
  if (storedInfo) {
    try {
      const parsed = JSON.parse(storedInfo)
      parsed.userData = parsed.userData || {}
      parsed.userData.realName = personalInfoForm.value.name
      parsed.userData.phone = personalInfoForm.value.phone
      parsed.userData.email = personalInfoForm.value.email
      parsed.userData.avatar = personalInfoForm.value.avatar
      localStorage.setItem('userInfo', JSON.stringify(parsed))
    } catch (error) {
      console.error('æ›´æ–°æœ¬åœ°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)
    }
  }
  
  alert('ä¸ªäººä¿¡æ¯ä¿å­˜æˆåŠŸï¼')
  
  // å…³é—­æ¨¡æ€æ¡†
  showPersonalInfoModal.value = false
}

// å–æ¶ˆä¸ªäººä¿¡æ¯ç¼–è¾‘
const cancelPersonalInfo = () => {
  showPersonalInfoModal.value = false
}

// å……å€¼è®°å½•ç›¸å…³æ–¹æ³•
const cancelRechargeRecord = () => {
  showRechargeRecordModal.value = false
}

// å¤„ç†å……å€¼
const handleRecharge = () => {
  showRechargeInfoModal.value = true
}

// åˆ†é¡µè·³è½¬
const goToPage = (page: number) => {
  if (page >= 1 && page <= totalPages.value) {
    currentPage.value = page
  }
}

// å……å€¼ä¿¡æ¯ç›¸å…³æ–¹æ³•
const cancelRechargeInfo = () => {
  showRechargeInfoModal.value = false
  // é‡ç½®è¡¨å•
  rechargeInfoForm.value = {
    amount: 100,
    paymentAccount: '',
    paymentMethod: 'å¾®ä¿¡æ”¯ä»˜'
  }
}

// å¢åŠ å……å€¼é‡‘é¢
const increaseAmount = () => {
  if (rechargeInfoForm.value.amount < 10000) {
    rechargeInfoForm.value.amount += 10
  }
}

// å‡å°‘å……å€¼é‡‘é¢
const decreaseAmount = () => {
  if (rechargeInfoForm.value.amount > 1) {
    rechargeInfoForm.value.amount -= 10
  }
}

// ç¡®è®¤å……å€¼
const confirmRecharge = () => {
  // éªŒè¯å¿…å¡«å­—æ®µ
  if (!rechargeInfoForm.value.amount || rechargeInfoForm.value.amount <= 0) {
    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å……å€¼é‡‘é¢')
    return
  }
  
  if (!rechargeInfoForm.value.paymentAccount.trim()) {
    alert('è¯·è¾“å…¥æ”¯ä»˜è´¦å·')
    return
  }
  
  if (!rechargeInfoForm.value.paymentMethod) {
    alert('è¯·é€‰æ‹©æ”¯ä»˜æ–¹å¼')
    return
  }
  
  // æ¨¡æ‹Ÿå……å€¼å¤„ç†
  console.log('å……å€¼ä¿¡æ¯:', rechargeInfoForm.value)
  
  // ç”Ÿæˆæ–°çš„å……å€¼è®°å½•
  const newRecord = {
    id: rechargeRecords.value.length + 1,
    amount: rechargeInfoForm.value.amount,
    accountType: rechargeInfoForm.value.paymentMethod,
    accountNumber: rechargeInfoForm.value.paymentAccount,
    rechargeTime: new Date().toLocaleString('zh-CN', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    }).replace(/\//g, '-')
  }
  
  // æ·»åŠ åˆ°å……å€¼è®°å½•åˆ—è¡¨çš„å¼€å¤´
  rechargeRecords.value.unshift(newRecord)
  
  // æ›´æ–°è´¦æˆ·ä½™é¢
  currentBalance.value += rechargeInfoForm.value.amount

  // åŒæ­¥æ›´æ–°ä¸ªäººä¿¡æ¯ä¸­çš„ä½™é¢
  personalInfoForm.value.balance = currentBalance.value.toFixed(2)
  
  alert(`å……å€¼æˆåŠŸï¼å……å€¼é‡‘é¢ï¼šÂ¥${rechargeInfoForm.value.amount}`)
  
  // å…³é—­æ¨¡æ€æ¡†
  showRechargeInfoModal.value = false
  
  // é‡ç½®è¡¨å•
  rechargeInfoForm.value = {
    amount: 100,
    paymentAccount: '',
    paymentMethod: 'å¾®ä¿¡æ”¯ä»˜'
  }
}


// é€€å‡ºç™»å½•
const logout = () => {
  if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
    removeToken()
    localStorage.removeItem('userInfo')
    showUserDropdown.value = false
    router.replace('/login')
  }
}

// ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰èœå•
const handleClickOutside = (event: Event) => {
  const target = event.target as HTMLElement
  if (!target.closest('.user-section')) {
    showUserDropdown.value = false
  }
}

onMounted(() => {
  document.addEventListener('click', handleClickOutside)

  if (!initializeUser()) {
    return
  }

  fetchUserProfile()
  fetchCategories()
  fetchServicesByCategory(activeCategory.value, 1)
})

onBeforeUnmount(() => {
  document.removeEventListener('click', handleClickOutside)

  if (serviceSearchTimer) {
    clearTimeout(serviceSearchTimer)
    serviceSearchTimer = null
  }
})

</script>

<style scoped>
/* å…¨å±€é‡ç½® */
* {
  box-sizing: border-box;
}

.user-home-container {
  height: 100vh;
  width: 100vw;
  display: flex;
  flex-direction: column;
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  position: fixed;
  top: 0;
  left: 0;
}

/* é¡¶éƒ¨å¯¼èˆªæ  */
.top-header {
  height: 60px;
  background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  z-index: 100;
  flex-shrink: 0;
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 100%;
  padding: 0 30px;
}

.logo-section .logo {
  color: white;
  font-size: 20px;
  font-weight: 600;
  margin: 0;
}

.user-section {
  display: flex;
  align-items: center;
  position: relative;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  padding: 8px 12px;
  border-radius: 6px;
  transition: background-color 0.3s ease;
}

.user-info:hover {
  background: rgba(255, 255, 255, 0.1);
}

/* ç”¨æˆ·å¤´åƒ */
.user-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  overflow: hidden;
  border: 2px solid rgba(255, 255, 255, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.1);
}

.avatar-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.avatar-placeholder {
  color: #fff;
  font-size: 16px;
  opacity: 0.8;
}

.username {
  color: white;
  font-size: 14px;
  font-weight: 500;
}

.dropdown-arrow {
  font-size: 12px;
  color: white;
  transition: transform 0.3s ease;
  opacity: 0.8;
}

.dropdown-arrow.active {
  transform: rotate(180deg);
}

.user-dropdown {
  position: absolute;
  top: 100%;
  right: 0;
  background: white;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  z-index: 1000;
  min-width: 150px;
  overflow: hidden;
  margin-top: 5px;
}

.dropdown-item {
  padding: 12px 16px;
  cursor: pointer;
  transition: background-color 0.3s ease;
  color: #333;
  font-size: 14px;
  border-bottom: 1px solid #f0f0f0;
}

.dropdown-item:last-child {
  border-bottom: none;
}

.dropdown-item:hover {
  background: #f0f8ff;
  color: #007bff;
}

/* ä¸»è¦å†…å®¹åŒºåŸŸå®¹å™¨ */
.content-wrapper {
  display: flex;
  flex: 1;
  height: calc(100vh - 60px);
}

/* ä¾§è¾¹å¯¼èˆªèœå• */
.sidebar-nav {
  width: 200px;
  background: white;
  box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
  overflow-y: auto;
  flex-shrink: 0;
}

.nav-menu {
  list-style: none;
  padding: 20px 0;
  margin: 0;
}

.nav-item {
  display: flex;
  align-items: center;
  padding: 15px 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  border-left: 3px solid transparent;
}

.nav-item:hover {
  background: #f8f9fa;
}

.nav-item.active {
  background: #e3f2fd;
  border-left-color: #8B4513;
  color: #8B4513;
}

.nav-icon {
  margin-right: 10px;
  font-size: 16px;
}

.nav-text {
  font-size: 13px;
  font-weight: 500;
}

/* ä¸»å†…å®¹åŒºåŸŸ */
.main-content {
  flex: 1;
  padding: 30px;
  overflow-y: auto;
  background: #e3f2fd;
  box-sizing: border-box;
}

.content-section h2 {
  color: #333;
  margin-bottom: 25px;
  font-size: 24px;
  font-weight: 600;
}

.content-section p {
  color: #666;
  font-size: 16px;
  line-height: 1.6;
}

/* é¦–é¡µæ ·å¼ */
.hero-section {
  background: linear-gradient(135deg, #ffb3ba 0%, #ffdfba 100%);
  border-radius: 12px;
  margin-bottom: 30px;
  overflow: hidden;
  position: relative;
  min-height: 300px;
}

.hero-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 40px;
  height: 100%;
}

.hero-text {
  flex: 1;
  z-index: 2;
}

.hero-title {
  font-size: 48px;
  font-weight: 700;
  color: #dc3545;
  margin: 0 0 10px 0;
  line-height: 1.2;
}

.hero-subtitle {
  font-size: 36px;
  font-weight: 600;
  color: #dc3545;
  margin: 0;
  line-height: 1.2;
}

.hero-illustration {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  z-index: 2;
}

/* æˆ¿é—´åœºæ™¯æ ·å¼ */
.room-scene {
  position: relative;
  width: 300px;
  height: 200px;
  background: #ffb3ba;
  border-radius: 8px;
  overflow: hidden;
}

.sofa {
  position: absolute;
  bottom: 20px;
  right: 20px;
  width: 120px;
  height: 60px;
  background: #87ceeb;
  border-radius: 8px;
}

.woman {
  position: absolute;
  left: 10px;
  top: -20px;
  width: 30px;
  height: 40px;
}

.woman-body {
  width: 20px;
  height: 25px;
  background: #ff69b4;
  border-radius: 4px;
  margin: 0 auto;
}

.woman-head {
  width: 15px;
  height: 15px;
  background: #8b4513;
  border-radius: 50%;
  margin: 2px auto;
}

.book {
  position: absolute;
  right: -5px;
  top: 5px;
  width: 8px;
  height: 10px;
  background: #4169e1;
  border-radius: 2px;
}

.child {
  position: absolute;
  left: 40px;
  top: -15px;
  width: 20px;
  height: 30px;
}

.child-body {
  width: 15px;
  height: 18px;
  background: #ffff00;
  border-radius: 3px;
  margin: 0 auto;
}

.child-head {
  width: 12px;
  height: 12px;
  background: #8b4513;
  border-radius: 50%;
  margin: 2px auto;
}

.cat {
  position: absolute;
  right: 5px;
  top: -10px;
  width: 15px;
  height: 10px;
  background: #ffffff;
  border-radius: 8px;
}

.plant {
  position: absolute;
  bottom: 10px;
  left: 20px;
  width: 20px;
  height: 40px;
  background: #32cd32;
  border-radius: 10px;
}

.clothes {
  position: absolute;
  left: 10px;
  top: 20px;
  width: 30px;
  height: 20px;
  background: #ffa500;
  border-radius: 4px;
}

.stool {
  position: absolute;
  left: 50px;
  bottom: 10px;
  width: 15px;
  height: 15px;
  background: #8b4513;
  border-radius: 2px;
}

.pictures {
  position: absolute;
  top: 20px;
  right: 20px;
}

.picture-1 {
  width: 20px;
  height: 15px;
  background: #87ceeb;
  border-radius: 2px;
  margin-bottom: 5px;
}

.picture-2 {
  width: 15px;
  height: 12px;
  background: #ff69b4;
  border-radius: 2px;
}

/* æœåŠ¡åˆ†ç±»æ ‡ç­¾ */
.service-category-tag {
  margin-bottom: 20px;
}

.service-category-tag span {
  background: #20b2aa;
  color: white;
  padding: 6px 16px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 500;
}

/* é¦–é¡µæœåŠ¡ç½‘æ ¼ */
.home-services-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  max-width: 1000px;
  margin: 0 auto;
}

.service-card {
  background: white;
  padding: 25px;
  border-radius: 12px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  border: 2px solid transparent;
}

.service-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  border-color: #20b2aa;
}

.service-icon {
  font-size: 40px;
  margin-bottom: 15px;
  display: block;
}

.service-card h3 {
  color: #333;
  margin-bottom: 10px;
  font-size: 18px;
  font-weight: 600;
}

.service-card p {
  color: #666;
  font-size: 14px;
  margin: 0;
  line-height: 1.4;
}

/* æœåŠ¡åˆ†ç±»å¯¼èˆª */
.service-categories {
  display: flex;
  gap: 30px;
  margin-bottom: 20px;
  padding: 20px;
  border-bottom: 1px solid #eee;
  overflow-x: auto;
  background: #fafafa;
  border-radius: 8px;
}

.category-item {
  padding: 8px 0;
  cursor: pointer;
  color: #666;
  font-size: 14px;
  white-space: nowrap;
  transition: all 0.3s ease;
  border-bottom: 2px solid transparent;
  font-weight: 500;
  position: relative;
}

.category-item:hover {
  color: #8B4513;
}

.category-item.active {
  color: #8B4513;
  border-bottom-color: #8B4513;
  font-weight: 600;
}

/* æœç´¢æ  */
.search-bar {
  display: flex;
  gap: 10px;
  margin-bottom: 30px;
  justify-content: flex-end;
}

.search-input {
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
  width: 200px;
}

.search-btn {
  padding: 8px 16px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.search-btn:hover {
  background: #0056b3;
}

.clear-btn {
  padding: 8px 16px;
  background: #ffc107;
  color: #333;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  transition: background-color 0.3s;
  white-space: nowrap;
  writing-mode: horizontal-tb;
  text-orientation: mixed;
}

.clear-btn:hover {
  background: #e0a800;
}

.service-status {
  margin: 10px 0 20px;
  font-size: 14px;
  color: #555;
}

.service-status.error-message {
  color: #c0392b;
}

.service-status.loading-message {
  color: #555;
}

.page-summary {
  margin-left: 12px;
  font-size: 13px;
  color: #666;
}

/* æ— æœç´¢ç»“æœæ ·å¼ */
.no-results {
  text-align: center;
  padding: 60px 20px;
  color: #666;
}

.no-results-icon {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.6;
}

.no-results-text {
  font-size: 18px;
  font-weight: 500;
  margin-bottom: 8px;
  color: #333;
}

.no-results-hint {
  font-size: 14px;
  color: #999;
}

/* æ“ä½œæŒ‰é’®æ ·å¼ - æŒ‰ç…§ç¬¬äºŒå¼ å›¾ç‰‡çš„æ ·å¼ */
.operation-cell {
  padding: 8px;
}

.operation-buttons {
  display: flex;
  flex-direction: column;
  gap: 4px;
  align-items: center;
}

.operation-btn {
  padding: 6px 12px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 500;
  min-width: 60px;
  transition: all 0.3s ease;
}

.operation-btn.evaluate {
  background: #007bff;
  color: white;
}

.operation-btn.evaluate:hover {
  background: #0056b3;
}

.operation-btn.cancel {
  background: #dc3545;
  color: white;
}

.operation-btn.cancel:hover {
  background: #c82333;
}

/* æœåŠ¡ç½‘æ ¼æ ·å¼ */
.services-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  margin-bottom: 30px;
}

.service-card {
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  padding: 20px;
  min-height: 200px;
}

.service-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
}

/* å¡ç‰‡è£…é¥°å…ƒç´  */
.card-decorations {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
}

.red-triangle {
  position: absolute;
  width: 0;
  height: 0;
  border-style: solid;
}

.red-triangle.top-left {
  top: 0;
  left: 0;
  border-width: 0 0 20px 20px;
  border-color: transparent transparent #dc3545 transparent;
}

.red-triangle.top-right {
  top: 0;
  right: 0;
  border-width: 0 20px 20px 0;
  border-color: transparent #dc3545 transparent transparent;
}


/* æœåŠ¡æ ‡é¢˜æ  */
.service-title-bar {
  background: #f8f9fa;
  border-radius: 20px;
  padding: 8px 16px;
  margin: 20px 0 10px 0;
  text-align: center;
}

.service-title {
  color: #8B4513;
  font-size: 16px;
  font-weight: 600;
}

.service-subtitle {
  color: #999;
  font-size: 12px;
  margin-bottom: 8px;
}

.service-description {
  color: #333;
  font-size: 13px;
  line-height: 1.4;
  margin-bottom: 20px;
}

.service-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: auto;
}

.service-price {
  color: #dc3545;
  font-size: 18px;
  font-weight: 600;
}

.service-booked {
  color: #999;
  font-size: 12px;
}

/* åˆ†é¡µæ ·å¼ */
.pagination {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 30px;
}

.pagination-info {
  color: #666;
  font-size: 14px;
}

.pagination-controls {
  display: flex;
  gap: 5px;
}

.page-btn {
  padding: 6px 12px;
  border: 1px solid #ddd;
  background: white;
  cursor: pointer;
  border-radius: 4px;
  font-size: 14px;
}

.page-btn:hover {
  background: #f8f9fa;
}

.page-btn.active {
  background: #8B4513;
  color: white;
  border-color: #8B4513;
}

/* å°è´´å£«æœç´¢æ  */
.tips-search-bar {
  display: flex;
  gap: 10px;
  margin-bottom: 30px;
  justify-content: flex-end;
}

.tips-search-input {
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
  width: 250px;
}

.tips-search-btn {
  padding: 8px 16px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.tips-search-btn:hover {
  background: #0056b3;
}

/* å°è´´å£«æ ·å¼ */
.tips-list {
  display: grid;
  gap: 20px;
  max-width: 1000px;
  margin: 0 auto;
}

.tip-item {
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  overflow: hidden;
  display: flex;
  transition: all 0.3s ease;
}

.tip-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
}

.tip-image {
  flex-shrink: 0;
  width: 120px;
  height: 80px;
}

.tip-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.tip-content {
  flex: 1;
  padding: 20px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.tip-content h3 {
  color: #333;
  margin-bottom: 10px;
  font-size: 16px;
  font-weight: 600;
  line-height: 1.4;
}

.tip-content p {
  color: #666;
  font-size: 14px;
  line-height: 1.6;
  margin-bottom: 15px;
  flex: 1;
}

.tip-meta {
  display: flex;
  gap: 20px;
  font-size: 12px;
  color: #999;
}

.tip-views,
.tip-date {
  display: flex;
  align-items: center;
  gap: 4px;
}

/* é¢„çº¦æœç´¢æ  */
.booking-search-bar {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  justify-content: flex-end;
}

.booking-search-input {
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
  width: 250px;
}

.booking-search-btn {
  padding: 8px 16px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  writing-mode: horizontal-tb;
  text-orientation: mixed;
  white-space: nowrap;
}

.booking-search-btn:hover {
  background: #0056b3;
}

/* é¢„çº¦è¡¨æ ¼æ ·å¼ */
.booking-table-container {
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  overflow: hidden;
  margin-bottom: 20px;
}

.booking-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

.booking-table th {
  background: #f8f9fa;
  padding: 12px 8px;
  text-align: left;
  font-weight: 600;
  color: #333;
  border-bottom: 1px solid #dee2e6;
  white-space: nowrap;
}

.booking-table td {
  padding: 12px 8px;
  border-bottom: 1px solid #f1f3f4;
  color: #333;
  vertical-align: middle;
}

.booking-table tbody tr:hover {
  background: #f8f9fa;
}

.booking-table tbody tr:last-child td {
  border-bottom: none;
}

/* é‡‘é¢æ ·å¼ */
.amount {
  color: #dc3545;
  font-weight: 600;
}

/* çŠ¶æ€æ ‡ç­¾ */
.status {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
  white-space: nowrap;
}

.status.completed {
  background: #d4edda;
  color: #155724;
}

.status.pending {
  background: #fff3cd;
  color: #856404;
}

.status.in-service {
  background: #d1ecf1;
  color: #0c5460;
}

.status.evaluated {
  background: #e2e3e5;
  color: #383d41;
}

.status.cancelled {
  background: #f8d7da;
  color: #721c24;
}

/* æ“ä½œæŒ‰é’® */
.action-btn {
  padding: 4px 12px;
  border: none;
  border-radius: 4px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.action-btn.evaluate {
  background: #007bff;
  color: white;
}

.action-btn.evaluate:hover {
  background: #0056b3;
}

.action-btn.cancel {
  background: #dc3545;
  color: white;
}

.action-btn.cancel:hover {
  background: #c82333;
}

/* é¢„çº¦åˆ†é¡µæ ·å¼ */
.booking-pagination {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 20px;
}

/* è¯„ä»·æœç´¢æ  */
.reviews-search-bar {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  justify-content: flex-end;
}

.reviews-search-input {
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
  width: 250px;
}

.reviews-search-btn {
  padding: 8px 16px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  white-space: nowrap;
  writing-mode: horizontal-tb;
  text-orientation: mixed;
}

.reviews-search-btn:hover {
  background: #0056b3;
}

/* æ‰¹é‡æ“ä½œ */
.batch-actions {
  margin-bottom: 20px;
}

.batch-delete-btn {
  padding: 8px 16px;
  background: #dc3545;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.batch-delete-btn:hover {
  background: #c82333;
}

/* è¯„ä»·è¡¨æ ¼æ ·å¼ */
.reviews-table-container {
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  overflow: hidden;
  margin-bottom: 20px;
}

.reviews-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

.reviews-table th {
  background: #f8f9fa;
  padding: 12px 8px;
  text-align: left;
  font-weight: 600;
  color: #333;
  border-bottom: 1px solid #dee2e6;
  white-space: nowrap;
}

.reviews-table td {
  padding: 12px 8px;
  border-bottom: 1px solid #f1f3f4;
  color: #333;
  vertical-align: middle;
}

.reviews-table tbody tr:hover {
  background: #f8f9fa;
}

.reviews-table tbody tr:last-child td {
  border-bottom: none;
}

/* å¤é€‰æ¡†æ ·å¼ */
.select-all,
.row-checkbox {
  width: 16px;
  height: 16px;
  cursor: pointer;
}

/* æ˜Ÿçº§è¯„åˆ†æ ·å¼ */
.star-rating {
  display: flex;
  gap: 2px;
}

.star {
  font-size: 16px;
  color: #ddd;
}

.star.filled {
  color: #ffc107;
}

.star.half {
  color: #ffc107;
  position: relative;
}

.star.half::after {
  content: 'â˜…';
  position: absolute;
  left: 0;
  top: 0;
  width: 50%;
  overflow: hidden;
  color: #ddd;
}

.star.empty {
  color: #ddd;
}

/* æ“ä½œæŒ‰é’® */
.action-btn {
  width: 32px;
  height: 32px;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  font-size: 14px;
  margin: 0 2px;
  transition: all 0.3s ease;
}

.action-btn.edit {
  background: #ffc107;
  color: #333;
}

.action-btn.edit:hover {
  background: #e0a800;
}

.action-btn.delete {
  background: #dc3545;
  color: white;
}

.action-btn.delete:hover {
  background: #c82333;
}

/* è¯„ä»·åˆ†é¡µæ ·å¼ */
.reviews-pagination {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 20px;
}



/* å“åº”å¼è®¾è®¡ */
@media (max-width: 1200px) {
  .services-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (max-width: 900px) {
  .services-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .home-services-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .hero-content {
    flex-direction: column;
    text-align: center;
  }
  
  .room-scene {
    width: 280px;
    height: 180px;
    margin-top: 20px;
  }
}

/* æ¨¡æ€æ¡†æ ·å¼ */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-content {
  background: white;
  border-radius: 8px;
  width: 90%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  border-bottom: 1px solid #eee;
}

.modal-header h3 {
  margin: 0;
  color: #333;
  font-size: 18px;
}

.close-btn {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: #999;
  padding: 0;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.close-btn:hover {
  color: #333;
}

.modal-body {
  padding: 20px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: #333;
}

.form-input, .form-select, .form-textarea {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
  box-sizing: border-box;
}

.form-input:focus, .form-select:focus, .form-textarea:focus {
  outline: none;
  border-color: #007bff;
  box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

.form-textarea {
  resize: vertical;
  min-height: 80px;
}

.form-input.error {
  border-color: #dc3545;
}

.error-message {
  color: #dc3545;
  font-size: 12px;
  margin-top: 5px;
  display: block;
}

.password-hint {
  font-size: 12px;
  color: #6c757d;
  margin-top: 5px;
}

.rating-input {
  display: flex;
  align-items: center;
  gap: 15px;
}

.form-select {
  width: auto;
  min-width: 100px;
}

.star-preview {
  display: flex;
  gap: 2px;
}

.star-preview .star {
  font-size: 20px;
  color: #ddd;
}

.star-preview .star.filled {
  color: #ffc107;
}

.star-preview .star.half {
  color: #ffc107;
  position: relative;
}

.star-preview .star.half::after {
  content: 'â˜…';
  position: absolute;
  left: 0;
  width: 50%;
  overflow: hidden;
  color: #ddd;
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  padding: 20px;
  border-top: 1px solid #eee;
}

.btn {
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.3s ease;
}

.btn-secondary {
  background: #6c757d;
  color: white;
}

.btn-secondary:hover {
  background: #5a6268;
}

.btn-primary {
  background: #007bff;
  color: white;
}

.btn-primary:hover {
  background: #0056b3;
}

/* é¢„çº¦è¯„ä»·æ¨¡æ€æ¡†ç‰¹æ®Šæ ·å¼ */
.booking-info {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 6px;
  margin-bottom: 20px;
  border-left: 4px solid #007bff;
}

.booking-info h4 {
  margin: 0 0 10px 0;
  color: #333;
  font-size: 16px;
}

.booking-info p {
  margin: 5px 0;
  color: #666;
  font-size: 14px;
}

.booking-info strong {
  color: #333;
}

.no-action {
  color: #999;
  font-style: italic;
}

/* ä¸ªäººä¿¡æ¯æ¨¡æ€æ¡†æ ·å¼ */
.personal-info-modal {
  max-width: 500px;
  width: 90%;
}

.personal-info-form {
  padding: 0;
}

/* å¤´åƒåŒºåŸŸ */
.avatar-group {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 20px;
}

.avatar-section {
  display: flex;
  align-items: center;
}

.avatar-container {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  overflow: hidden;
  cursor: pointer;
  border: 2px solid #e0e0e0;
  transition: all 0.3s ease;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

.avatar-container:hover {
  border-color: #007bff;
  transform: scale(1.05);
}

.avatar-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.avatar-placeholder {
  width: 100%;
  height: 100%;
  background: #f5f5f5;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
}

.avatar-icon {
  font-size: 32px;
  color: #999;
}

/* åªè¯»è¾“å…¥æ¡† */
.form-input.readonly {
  background: #f8f9fa;
  color: #6c757d;
  cursor: not-allowed;
}

/* è´¦æˆ·ä½™é¢æ˜¾ç¤º */
.balance-display {
  display: flex;
  align-items: center;
}

.balance-amount {
  background: #007bff;
  color: white;
  padding: 8px 16px;
  border-radius: 6px;
  font-weight: 600;
  font-size: 16px;
}

/* ä¸ªäººä¿¡æ¯æ¨¡æ€æ¡†ä¿å­˜æŒ‰é’®æ ·å¼ */
.personal-info-form .save-btn {
  background: #007bff;
  color: white;
  border: none;
  padding: 12px 30px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease;
  min-width: 120px;
  margin-top: 20px;
}

.personal-info-form .save-btn:hover {
  background: #0056b3;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
}

.personal-info-form .save-btn:active {
  transform: translateY(0);
}

/* å……å€¼è®°å½•æ¨¡æ€æ¡†æ ·å¼ */
.recharge-record-modal {
  max-width: 800px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
}

/* å……å€¼æ“ä½œåŒºåŸŸ */
.recharge-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 8px;
}

.recharge-btn {
  background: #007bff;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.recharge-btn:hover {
  background: #0056b3;
  transform: translateY(-1px);
}

.balance-info {
  display: flex;
  align-items: center;
  gap: 8px;
}

.balance-label {
  color: #333;
  font-size: 14px;
}

.balance-amount {
  color: #dc3545;
  font-size: 16px;
  font-weight: 600;
}

/* å……å€¼è®°å½•è¡¨æ ¼ */
.recharge-table-container {
  margin-bottom: 20px;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.recharge-table {
  width: 100%;
  border-collapse: collapse;
  background: white;
}

.recharge-table thead {
  background: #f8f9fa;
}

.recharge-table th {
  padding: 12px 15px;
  text-align: left;
  font-weight: 600;
  color: #333;
  border-bottom: 2px solid #dee2e6;
  font-size: 14px;
}

.recharge-table td {
  padding: 12px 15px;
  border-bottom: 1px solid #dee2e6;
  font-size: 14px;
}

.record-row:hover {
  background: #f8f9fa;
}

.amount {
  color: #dc3545;
  font-weight: 600;
}

.account-type {
  color: #333;
}

.account-number {
  color: #666;
  font-family: monospace;
}

.recharge-time {
  color: #666;
}

/* åˆ†é¡µæ ·å¼ */
.pagination {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 20px;
  padding: 15px 0;
}

.pagination-info {
  color: #666;
  font-size: 14px;
}

.pagination-controls {
  display: flex;
  gap: 5px;
}

.page-btn {
  padding: 8px 12px;
  border: 1px solid #dee2e6;
  background: white;
  color: #333;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.3s ease;
  min-width: 40px;
}

.page-btn:hover:not(:disabled) {
  background: #f8f9fa;
  border-color: #007bff;
}

.page-btn.active {
  background: #007bff;
  color: white;
  border-color: #007bff;
}

.page-btn:disabled {
  background: #f8f9fa;
  color: #ccc;
  cursor: not-allowed;
  border-color: #e9ecef;
}

/* å……å€¼ä¿¡æ¯æ¨¡æ€æ¡†æ ·å¼ */
.recharge-info-modal {
  max-width: 500px;
  width: 90%;
}

.recharge-info-form {
  padding: 0;
}

/* å……å€¼é‡‘é¢è¾“å…¥åŒºåŸŸ */
.amount-input-wrapper {
  display: flex;
  align-items: center;
  gap: 0;
  border: 1px solid #dee2e6;
  border-radius: 6px;
  overflow: hidden;
  background: white;
}

.amount-btn {
  background: #f8f9fa;
  border: none;
  padding: 12px 16px;
  cursor: pointer;
  font-size: 18px;
  font-weight: 600;
  color: #333;
  transition: all 0.3s ease;
  min-width: 50px;
}

.amount-btn:hover {
  background: #e9ecef;
}

.amount-btn.decrease {
  border-right: 1px solid #dee2e6;
}

.amount-btn.increase {
  border-left: 1px solid #dee2e6;
}

.amount-input {
  border: none;
  padding: 12px 16px;
  font-size: 16px;
  text-align: center;
  flex: 1;
  outline: none;
  background: white;
}

.amount-input:focus {
  outline: none;
  box-shadow: none;
}

/* æ”¯ä»˜æ–¹å¼é€‰æ‹© */
.payment-methods {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.payment-option {
  position: relative;
}

.payment-radio {
  position: absolute;
  opacity: 0;
  pointer-events: none;
}

.payment-label {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px;
  border: 2px solid #e9ecef;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  background: white;
}

.payment-label:hover {
  border-color: #007bff;
  background: #f8f9ff;
}

.payment-radio:checked + .payment-label {
  border-color: #007bff;
  background: #f0f8ff;
}

.payment-radio:checked + .payment-label .payment-icon {
  transform: scale(1.1);
}

.payment-icon {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  transition: all 0.3s ease;
}

.wechat-icon {
  background: #07c160;
  color: white;
}

.alipay-icon {
  background: #1677ff;
  color: white;
}

.payment-text {
  flex: 1;
}

.payment-name {
  font-size: 16px;
  font-weight: 600;
  color: #333;
  margin-bottom: 2px;
}

.payment-subtitle {
  font-size: 12px;
  color: #666;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* è¡¨å•æ“ä½œæŒ‰é’® */
.recharge-info-form .form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid #e9ecef;
}

.recharge-info-form .btn {
  padding: 12px 24px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
  min-width: 80px;
}

.recharge-info-form .btn-secondary {
  background: #f8f9fa;
  color: #6c757d;
  border: 1px solid #dee2e6;
}

.recharge-info-form .btn-secondary:hover {
  background: #e9ecef;
  color: #495057;
}

.recharge-info-form .btn-primary {
  background: #007bff;
  color: white;
}

.recharge-info-form .btn-primary:hover {
  background: #0056b3;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
}

.recharge-info-form .btn-primary:active {
  transform: translateY(0);
}



@media (max-width: 768px) {
  .content-wrapper {
    flex-direction: column;
  }
  
  .sidebar-nav {
    width: 100%;
    height: auto;
    order: 2;
  }
  
  .nav-menu {
    display: flex;
    padding: 10px 0;
    overflow-x: auto;
  }
  
  .nav-item {
    flex-shrink: 0;
    padding: 10px 20px;
    border-left: none;
    border-bottom: 3px solid transparent;
  }
  
  .nav-item.active {
    border-left: none;
    border-bottom-color: #8B4513;
  }
  
  .main-content {
    order: 1;
    padding: 20px;
  }
  
  .hero-content {
    flex-direction: column;
    text-align: center;
    padding: 30px 20px;
  }
  
  .hero-title {
    font-size: 36px;
  }
  
  .hero-subtitle {
    font-size: 28px;
  }
  
  .room-scene {
    width: 250px;
    height: 150px;
    margin-top: 20px;
  }
  
  .home-services-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
  }
  
  .services-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .service-categories {
    gap: 10px;
  }
  
  .category-item {
    padding: 6px 12px;
    font-size: 13px;
  }
  
  .search-bar {
    flex-direction: column;
    align-items: stretch;
  }
  
  .search-input {
    width: 100%;
  }
  
  .tips-search-bar {
    flex-direction: column;
    align-items: stretch;
  }
  
  .tips-search-input {
    width: 100%;
  }
  
  .tip-item {
    flex-direction: column;
  }
  
  .tip-image {
    width: 100%;
    height: 120px;
  }
  
  .booking-search-bar {
    flex-direction: column;
    align-items: stretch;
  }
  
  .booking-search-input {
    width: 100%;
  }
  
  .booking-table-container {
    overflow-x: auto;
  }
  
  .booking-table {
    min-width: 1200px;
  }
  
  .reviews-search-bar {
    flex-direction: column;
    align-items: stretch;
  }
  
  .reviews-search-input {
    width: 100%;
  }
  
  .reviews-table-container {
    overflow-x: auto;
  }
  
  .reviews-table {
    min-width: 1000px;
  }
  
  .personal-info-modal {
    width: 95%;
    margin: 10px;
  }
  
  .avatar-group {
    flex-direction: column;
    align-items: flex-start;
    gap: 15px;
  }
  
  .avatar-container {
    width: 70px;
    height: 70px;
  }
  
  .avatar-icon {
    font-size: 28px;
  }
  
  /* å……å€¼è®°å½•æ¨¡æ€æ¡†ç§»åŠ¨ç«¯æ ·å¼ */
  .recharge-record-modal {
    width: 95%;
    margin: 10px;
    max-height: 95vh;
  }
  
  .recharge-actions {
    flex-direction: column;
    gap: 15px;
    align-items: stretch;
  }
  
  .recharge-btn {
    width: 100%;
    padding: 12px;
  }
  
  .balance-info {
    justify-content: center;
  }
  
  .recharge-table-container {
    overflow-x: auto;
  }
  
  .recharge-table {
    min-width: 600px;
  }
  
  .recharge-table th,
  .recharge-table td {
    padding: 8px 10px;
    font-size: 12px;
  }
  
  .pagination {
    flex-direction: column;
    gap: 15px;
    align-items: center;
  }
  
  .pagination-controls {
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .page-btn {
    padding: 6px 10px;
    font-size: 12px;
    min-width: 35px;
  }
  
  /* å……å€¼ä¿¡æ¯æ¨¡æ€æ¡†ç§»åŠ¨ç«¯æ ·å¼ */
  .recharge-info-modal {
    width: 95%;
    margin: 10px;
  }
  
  .amount-input-wrapper {
    flex-direction: column;
    gap: 0;
  }
  
  .amount-btn {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    min-width: auto;
  }
  
  .amount-btn.decrease {
    border-right: none;
    border-bottom: 1px solid #dee2e6;
  }
  
  .amount-btn.increase {
    border-left: none;
    border-top: 1px solid #dee2e6;
  }
  
  .amount-input {
    padding: 15px;
    font-size: 18px;
  }
  
  .payment-methods {
    gap: 10px;
  }
  
  .payment-label {
    padding: 12px;
  }
  
  .payment-icon {
    width: 35px;
    height: 35px;
    font-size: 18px;
  }
  
  .payment-name {
    font-size: 14px;
  }
  
  .payment-subtitle {
    font-size: 11px;
  }
  
  .recharge-info-form .form-actions {
    flex-direction: column;
    gap: 10px;
  }
  
  .recharge-info-form .btn {
    width: 100%;
    padding: 14px;
    font-size: 16px;
  }
  
}

</style>